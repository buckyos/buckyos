#!/usr/bin/python3
import sys
import os
import argparse

current_dir = os.path.dirname(os.path.abspath(__file__))
sys.path.append(current_dir)
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
sys.path.append(os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))))
import util


parser = argparse.ArgumentParser(description="cyfs_gateway startup script")
parser.add_argument("--keep_tunnel", type=str,required=False, help="keep tunnel")
parser.add_argument("--reload", action="store_true", help="reload gateway config")
args = parser.parse_args()

if args.reload:
    run_cmd = f"{current_dir}/cyfs_gateway reload"
    os.system(run_cmd)
    sys.exit(0)

keep_tunnel = args.keep_tunnel

run_cmd = f"{current_dir}/cyfs_gateway "
if keep_tunnel is not None:
    run_cmd += f" --keep_tunnel {keep_tunnel}"
util.nohup_start(run_cmd)
    
print("start cyfs_gateway service success!")
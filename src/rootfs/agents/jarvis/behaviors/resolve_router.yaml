# Compiled prompt example (from PromptBuilder, simplified):
# [system]
# <<ROLE>>
# ...content from role.md...
# <</ROLE>>
# <<SELF>>
# ...content from self.md...
# <</SELF>>
# <<BEHAVIOR>>
# Resolve session context for the current wakeup and decide optional routing.
# Keep tool usage minimal. If no behavior switch is needed, keep next_behavior null.
# <</BEHAVIOR>>
# <<POLICY_SUMMARY>>
# agent.did: did:example:jarvis
# loop.session_id: session-user-1
# step.index: 0
# step.remaining: 8
# <</POLICY_SUMMARY>>
# <<STEP_HINTS>>
# loop.session_id: session-user-1
# loop.event_id: evt-123
# step.index: 0
# step.remaining: 8
# <</STEP_HINTS>>
# <<OUTPUT_PROTOCOL>>
# Return exactly one JSON object and no extra text.
# ... (exactly the text configured in output_protocol.text below) ...
# <</OUTPUT_PROTOCOL>>
# [user]
# <<INBOX>>
# {"trigger":"on_wakeup","raw_payload":{"message":"帮我总结项目状态"}}
# <</INBOX>>
# [user]
# <<MEMORY>>
# {"facts":[{"kind":"project","name":"opendan"}]}
# <</MEMORY>>
# [user]
# <<TOOLS>>
# ...tool specs filtered by allow_list...
# <</TOOLS>>
#
# Typical LLM return example (JSON only):
# {
#   "next_behavior": null,
#   "thinking": "bind session and collect minimal context",
#   "reply": [],
#   "tool_calls": [],
#   "todo": [],
#   "set_memory": [],
#   "actions": [],
#   "session_delta": [],
#   "output": {
#     "session_id": "session-user-1",
#     "new_session": null,
#     "next_behavior": "on_wakeup",
#     "memory_queries": ["project status", "todo follow-up"],
#     "reply": "收到，先整理项目状态。"
#   }
# }

process_rule: |
  Resolve session context for the current wakeup and decide optional routing.
  Keep tool usage minimal. If no behavior switch is needed, keep next_behavior null.

output_protocol:
  mode: json_v1
  text: |
    Return exactly one JSON object and no extra text.
    Use this schema:
    {
      "next_behavior": "string|null",
      "thinking": "string|null",
      "reply": [],
      "tool_calls": [
        {
          "name": "string",
          "args": {},
          "call_id": "string"
        }
      ],
      "todo": [],
      "set_memory": [],
      "actions": [],
      "session_delta": [],
      "output": {
        "session_id": "string|null",
        "new_session": ["string", "string"],
        "next_behavior": "string|null",
        "memory_queries": ["string"],
        "reply": "string|null"
      }
    }
    Keep "output" as an object even when some fields are null/empty.

tools:
  mode: allow_list
  names:
    - load_memory
    - load_things
    - list
    - todo_manage

limits:
  max_tool_rounds: 1
  max_tool_calls_per_round: 4
  deadline_ms: 45000

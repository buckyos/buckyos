# Compiled prompt example (from PromptBuilder, simplified):
# [system]
# <<ROLE>>
# ...content from role.md...
# <</ROLE>>
# <<SELF>>
# ...content from self.md...
# <</SELF>>
# <<BEHAVIOR>>
# Resolve session context for the current wakeup and decide optional routing.
# Keep tool usage minimal. If no behavior switch is needed, keep next_behavior null.
# <</BEHAVIOR>>
# <<POLICY_SUMMARY>>
# agent.did: did:example:jarvis
# loop.session_id: session-user-1
# step.index: 0
# step.remaining: 8
# <</POLICY_SUMMARY>>
# <<STEP_HINTS>>
# loop.session_id: session-user-1
# loop.event_id: evt-123
# step.index: 0
# step.remaining: 8
# <</STEP_HINTS>>
# <<OUTPUT_PROTOCOL>>
# Return exactly one JSON object and no extra text.
# ... (exactly the text configured in output_protocol.text below) ...
# <</OUTPUT_PROTOCOL>>
# [user]
# <<INBOX>>
# {"trigger":"on_wakeup","raw_payload":{"message":"帮我总结项目状态"}}
# <</INBOX>>
# [user]
# <<MEMORY>>
# {"facts":[{"kind":"project","name":"opendan"}]}
# <</MEMORY>>
# [user]
# <<TOOLS>>
# ...tool specs filtered by allow_list...
# <</TOOLS>>
#
# Typical LLM return example (JSON only):
# {
#   "session_id": "session-user-1",
#   "new_session": null,
#   "next_behavior": "on_wakeup",
#   "memory_queries": ["project status", "todo follow-up"],
#   "reply": "收到，先整理项目状态。"
# }

process_rule: |
  Resolve session context for the current wakeup and decide optional routing.
  Keep tool usage minimal. If no behavior switch is needed, keep next_behavior null.

output_protocol:
  mode: json_v1
  text: |
    Return exactly one JSON object and no extra text.
    The JSON object must match ResolveRouterResult exactly:
    {
      "session_id": "string|null (optional)",
      "new_session": [
        "title (string)",
        "description (string)"
      ],
      "next_behavior": "string|null (optional)",
      "memory_queries": ["string", "..."],
      "reply": "string|null (optional)"
    }
    Notes:
    - If no new session is needed, set "new_session" to null.
    - If no behavior switch is needed, set "next_behavior" to null.
    - "memory_queries" should be an array; use [] when not needed.

tools:
  mode: allow_list
  names:
    - load_memory
    - load_things
    - list
    - todo_manage

limits:
  max_tool_rounds: 1
  max_tool_calls_per_round: 4
  deadline_ms: 45000

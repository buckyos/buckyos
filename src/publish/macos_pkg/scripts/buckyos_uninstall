#!/bin/zsh
set -e
BUCKYOS_ROOT="${BUCKYOS_ROOT:-/opt/buckyos}"
PLIST="/Library/LaunchAgents/buckyos.service.plist"
echo "[buckyos] uninstall: stopping service"
launchctl stop buckyos.service || true
launchctl unload "$PLIST" || true
rm -f "$PLIST" || true
echo "[buckyos] uninstall: removing files (keep data_paths)"
rm -rf "$BUCKYOS_ROOT/bin/app-loader"
rm -rf "$BUCKYOS_ROOT/bin/buckycli"
rm -rf "$BUCKYOS_ROOT/bin/control-panel"
rm -rf "$BUCKYOS_ROOT/bin/node-active"
rm -rf "$BUCKYOS_ROOT/bin/node-daemon"
rm -rf "$BUCKYOS_ROOT/bin/repo-service"
rm -rf "$BUCKYOS_ROOT/bin/scheduler"
rm -rf "$BUCKYOS_ROOT/bin/smb-service"
rm -rf "$BUCKYOS_ROOT/bin/stop.py"
rm -rf "$BUCKYOS_ROOT/bin/sys-test"
rm -rf "$BUCKYOS_ROOT/bin/system-config"
rm -rf "$BUCKYOS_ROOT/bin/util.py"
rm -rf "$BUCKYOS_ROOT/bin/verify-hub"
rm -rf "$BUCKYOS_ROOT/etc/boot_gateway.yaml"
rm -rf "$BUCKYOS_ROOT/etc/scheduler"
if [ -d "$BUCKYOS_ROOT/etc" ]; then
  for item in "$BUCKYOS_ROOT/etc"/*; do
    name="$(basename "$item")"
    case "$name" in cyfs_gateway.yaml|node_gateway.json|post_gateway.yaml|user_gateway.yaml) continue ;; esac
    rm -rf "$item"
  done
fi

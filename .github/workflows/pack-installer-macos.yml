name: Build MACOS DMG Installer
on: 
    workflow_call:
        inputs:
            version:
                required: true
                type: string
            build_time:
                required: true
                type: string
            run_id:
                required: true
                type: number
    workflow_dispatch:
        inputs:
            version:
                required: true
                type: string
            build_time:
                required: true
                type: string
            run_id:
                required: true
                type: number
jobs:
    pack:
        runs-on: macos-latest
        strategy:
            matrix:
                arch: ["aarch64"]
        steps:
            - name: Checkout
              uses: actions/checkout@v4
            - name: clean old rootfs
              run: rm -rf ./src/rootfs 
            - name: Download Artifact
              uses: actions/download-artifact@v4
              with:
                  name: buckyos-macos-${{matrix.arch}}-${{inputs.version}}-${{ inputs.build_time }}
                  github-token: ${{ secrets.GITHUB_TOKEN }}
                  run-id: ${{inputs.run_id}}
            - name: untar rootfs
              run: tar -xvf rootfs.tar
            - name: check rootfs
              run: ls -l ./src/rootfs
            - name: Download Tools
              uses: actions/download-artifact@v4
              with:
                name: buckyos-tools-linux-x86_64-${{inputs.version}}-${{ inputs.build_time }}
            - name: Prepare Tools
              run: chmod +x ./tools/*

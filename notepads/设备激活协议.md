#设备激活相关协议

## 设备搜索
- 激活本机的buckyos service的流程应该更自动化
- 通过扫描可能的ip端，尝试连接tcp的3182端口，连接成功就有可能是待激活设备
- UDP广播，在与局域网想 3182 UDP端口发送广播包，如果收到的了回复 (Device Info)，则根据回复内容可以判断是否是待激活设备

## 获得设备详细信息
- 得到待激活设备的IP后，可以使用GET http://$device_ip:3182/device 来获得设备的Device Info,根据Device Info的字段，可以丰富待激活设备列表的显示，并在激活前展示更丰富的设备信息
- 从安全的角度，有的设备使用URL参数来对激活进行保护，比如要 GET http://$device_ip:3182/device?key=xxxx 才能获得设备的DeviceInfo. 设备可以通过物理标签（或2维码）的方法，告知在激活流程里，必须先输入key (对码)
- 找到待激活设备后，点击`立刻激活`会进入激活流程。

## DeviceInfo的详细设计
```json

{
  "hostname":"liu-mba.local"
  "device_type": "ood",
  "arch": "arm64",
  "base_os_info": "Darwin 15.7.2 24.6.0",
  "state": "inactive", //已经激活是actived
  "active_url": "./index.html",
  "cpu_info": "Apple M4 @ 4464 MHz,(10 cores)",
  "cpu_num": 10,
  "cpu_mhz": 44640,
  "cpu_ratio": 1.0,
  "total_mem": 34359738368,
  "total_space": 1989325168640,
  "disk_usage": 694009551312,
  "gpu_info": "No GPU detected or unable to get GPU information"
}

```
## 使用DeviceInfo中定义的激活URL开始激活流程
- 在钱包的web容器中，打开DeviceInfo定义的激活URL
- 如果该URL是相对URL，则http://$device_ip:3182/$active_url 打开激活页
- 如果该URL是绝对URL（通常是https开头),则使用https://$active_url 打开激活页
- 打开URL时，应附加参数 ?source=xxxx ，说明时从哪个路径进入的激活流程，可能会对激活页的展示有影响


## 使用通用激活流程激活（暂不实现）
- 根据DeviceInfo中的信息，在钱包里展示通用的激活流程
- 最后的激活产物，使用 POST http://$device_ip:3182/$active_path 的方式，推送给设备
- 等待POST返回，设备激活成功
- 再次访问 http://$device_ip:3182/device ，返回已经激活的设备信息（或不返回）

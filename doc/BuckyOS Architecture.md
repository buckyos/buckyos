# buckyos系统架构

buckyos面向C端的Cloud OS (Network OS).其首要设计目标是，然让消费者能拥有一个自己的集群/云（为了和常规的术语进行区分，我们把这个集群称作Zone），消费者自己拥有的所有设备，设备上的计算资源都接入这个集群。消费者可以像安装App一样在自己的Zone内安装Service(我们称作DEC App Service 或则缩写成dApp).基于buckyos,用户可以拥有可以访问自己的所有数据、设备、和服务的AI Agent。

buckyos要实现“人人都有自己的云”的目标，必须实现Zero Operation：普通消费者不可能有专业的运维能力。我们要在此前提下保障系统的可靠性、安全性、稳定性。也需要提供足够的范式/限制给dApp的开发者。这也是buckyos要解决的核心问题。

我们也希望buckyos可以被应用在传统的云计算（更好的IaaS + PaaS）, 可以在一个物理Zone内部创建多个完全隔离的逻辑Zone, 也可以由多个物理Zone组成一个大的逻辑Zone。以实现共享云计算。当上述两个目标发生冲突时，我们会优先保障第一个目标。


## bukcyos要解决的关键问题

## buckyos与k8s的区别





## 核心的设计原则
1. Zero Dpendency & Zero Trust（0依赖与0信任）


2. Zero OPS (0运维)

3. 简单可靠
能不在内核中实现的功能就不在内核中实现
能不在系统服务中实现的功能旧不在系统服务中实现
显然的可靠：谨慎的选择一样简单可靠的第三方库，并保持review
模块划分时可以为简单性放弃一些可复用性，任何模块的实现都应尽力减少review代码时的心智负担，谨慎的添加我们专有的概念

4. Let it crash
在分布式系统中不要害怕Crash,当出现异常（预期外的任何情况）时，留下日志，然后crash(退出)。
默认不做任何重试，也不要尝试“拉起”任何自己的依赖项。系统里有几个核心的组件会上

6. log first
日志系统是分布式系统中的重要基础设施，他不但在开发阶段为开发者诊断BUG服务，更是很多功能在需要“”
理解buckyos日志规范(尤其是info级别以上)，是所有开发者的首要任务。
trace/debug用于开发状态，
系统默认运行在info级别。完成了请求，或更新了状态，都要写入一行Info级别的日志
warning是产生了常规的错误
error是产生了异常，但并不影响进程的基础工作（期待会恢复）
fatal通常代表故障，一个进程打玩fatal后通常会自我结束


5. 无调度器（没有潜规则）
基于Zone的状态进行实时的调度是一个美好的愿望，但这通常并不是一个好主意：分布式系统里的全局状态，通常是难以完整且实时的得到的，而基于该状态下发的指令，也很难做到完整的，实时的执行。因此应减少直觉性的“控制->反馈”操作，在分布式系统繁忙（也是最需要调度的时候），反馈的准确性会下降，控制的延迟会上升。应该多用可收敛的，单节点逻辑，通过自组织的方法来实现调度的目的。

没有潜规则的概念来源于网络研发中的：不要随意添加Queue或重试机制。应用开发者在大部分情况下能做到完整，直接的资源的控制。



## 整体架构



## 关键的的技术创新

### 使用去中心的Zone外基础设施

### 使用面向身份的基础网络协议

### 使用基于内容寻址的httpv4协议

### cyfs gateway
1. 支持ZONE内设备可以跨越多个不同的NAT
2. 支持ZONE向公共网络提供服务
3. 对ZONE的外部访问（非ZONE内流量）进行管理 （比如跟踪和限制某个特定App的流量）
4. 可打开对Zone的所有流量智能管理（比如parent control)，这里包括对流量的内容进行识别，对使用流量的App和目标Zone进行识别
5. 提供整体的，对CYFS协议(httpv4)协议的支持
6. 可打开协议向下兼容服务，支持用旧协议访问新访问你


## 系统的核心逻辑
任何操作系统都追求简单可靠的内核设计，buckyos也不例外。我们希望buckyos的内核设计，只有几个


## 支持不同级别的可用性和可靠性要求
可用性和可靠性是需要成本来支持的，buckyos的伸缩性设计可以在不同的成本环境下，以可预期的可用性/可靠性

低可用不可靠状态：只有一台服务器。此环境基本只能用于测试，保存在Zone内的任何数据随时都有丢失的可能。
低可用低可靠状态：只有一台物理机，但配置了Zone外的备份服务。通过定期备份，Zone的大部分数据都是安全的，系统存在丢失小部分数据的可能性（0.3%）
高可用低可靠状态：有一台物理机，和一台云端的VM（cache机），并配置了Zone外的备份服务。系统的读操作是99.9997%高可用的，
高可用高可靠状态

系统的负载也对上诉特性有所影响。由于负载是动态的，buckyos里可靠的负载统计系统，也会给出可用性/可靠性警告。比如当系统的写入速度超过备份速度时


## 系统启动流程

### 引导


### 内核(服务)启动


### 系统服务启动

### 系统服务器加载System Plugin

### App服务启动


### App Framework (语言相关)


## 系统的备份与恢复流程
“数据是我们最重要的财富！”


1. 系统的引导配置
2. 系统配置
3. 用户数据

### 备份方式
1. 定期（增量）冷备


2. 自动热备+定期冷备



### 恢复流程

## 系统的scale流程


## 系统的故障恢复流程


## 系统资源的释放
资源的释放主要有两种
1. 删除数据，主要是自动的缓存清理和手工的应用数据\用户数据清理。从已知服务的运行情况来看，除非有BUG，任何用户都不应该需要删除重要的数据
2. 减少硬件（配置降级），这对大规模集群来说是常事，但对于普通人拥有的Zero DevOps环境，我们认为释放硬件资源是小概率事件（处非用户一开始购买的硬件资源实在是超出实际需要太多），因此系统并不强求能在任何情况下，都能释放硬件资源。







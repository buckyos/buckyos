# 创建亲子（家庭）账号

摘要：本章主要描述BuckyOS的多用户支持，默认的用户组权限配置。从隐私控制的角度，多用户系统可以降低用户使用BuckyOS的门槛，因此依旧会对普通用户做完整的隐私隔离。

## 一、多用户支持

考虑到Personal Server（Cluster）的运维难度，一个用户购买并完成初始设置后，通常是为全家提供服务。因此正常情况下，一个Zone里有一个管理员用户加一系列普通用户和一些受限用户（未成年人）。BuckyOS的多用户体系如下：

- 家庭的每个成员都有自己的独立账号
- 管理员可以创建普通用户和受限用户，并设置他们的权限
- 账号本质上是秘钥对,因此一个用户可以拥有多个账号，也可以让一个账号在多个Zone中使用
- 每个账号的/home 数据默认是互相隔离的（所有的个人数据都是隔离的）
- BuckyOS的/library 数据默认是所有用户共享的，大部分情况下都是Owner可读写，其它用户只读
- dApp在安装的时候会设置是给所有人使用还是给自己使用。如果是给所有人使用，那么所有人都可以看到这个dApp。如果是给自己使用，那么只有安装的人可以看到这个dApp。
- 只有管理员才可以安装给所有人使用的dApp
- BuckyOS对多个用户使用同一个dApp提供了默认的隔离方式，但开发者也可以选择用自己的逻辑来更好的支持多用户同时使用
- 用户可以单独备份和恢复自己的个人数据，也可把自己的个人数据导出到另一个Zone中

### 用户组

- 管理员组，可以给自己安装dApp,可以修改系统配置，但高级配置需要签名
- 普通用户组，可以给自己安装dApp,不可以修改系统配置
- 受限用户组，不能安装dApp,只能看到分级后的内容
- 内网访客组, 只能看到公开的内容，能访问dApp的服务（如果该dApp支持访客组）
- 公网好友组，可以看到公开的内容以及一些更多的授权内容，能访问公网服务
- 公网访客组，可以看到公开的内容，能访问公网服务

### 受限账号与家长控制

受限账号无法安装DApp,并根据基本的设置自动启用“未成年人”保护功能。
儿童账号：受到家长控制功能的影响，无法安装DApp，只能看到分级后的内容
老人账号：UI字体更大，很多功能更自动。虽然可以看到全部的内容，但优先看到挑选后的内容（比如小朋友的照片）

### 账号的迁移

- 受限账号可以升级成普通账号
- 普通账号可以降级成受限账号
- 普通账号可以升级成管理员账号

上述操作的实现逻辑，就是让用户进入了新的用户组

### 用户之间的隔离

#### Zone内的权限隔离

这是最基础的隔离，Zone的管理员可以给不同的DID不同权限。

#### 数据(DFS)的隔离

用户数据基于BuckyOS提供的Frame Service保存。目前最主要是通过DFS保存。DFS默认是通过目录权限配置实现互相隔离的。比如用户A看不到用户B的文档。这种隔离相对来说是性能向的，基于DFS底层的对象管理，虽然用户A和用户B的目录是隔离的，但保存在隔离的目录里的同一张照片只占用了一份存储空间。

#### 隐私隔离

基于权限的管理意味着有更高权限的用户（比如管理员）可以查看所有人的数据，然后我们不认为任何两个成年人之间默认可以有这种能力。因此，我们希望DFS能支持类似bitlock的技术，在文件保存的时候，基于用户的秘钥对进行了加密。这样，即使是管理员，也只是拥有删除和修改这些数据的权限，而无法读取另一个普通用户的数据，保护了用户的隐私。

这个功能的核心在于如何别“绊倒自己”，防止出现用户未保存好秘钥导致自己的私有数据全部丢失的情况。 我们一方面在秘钥管理上要做好，分离不同功能的秘钥。另一方面，我们通过用户数据备份，让用户有机会在丢失秘钥后，通过已备份数据恢复个人数据。

#### Quota management

对于超大型的Zone，我们可以可能需要对每个用户能使用的资源进行配额管理。配额管理有两种数字设定方法

1. 基于百分比的设定，当上级Group的配额增加时，可以同步增加配额
2. 基于绝对值的设定，当上级Group的配额增加时，不会同步增加配额

需要进行配额的资源有：

- 存储空间
- 缓存空间
- 计算资源（CPU+GPU)
- 带宽,分Zone内和Zone外
- 磁盘读写性能

#### 应用程序容器隔离

大部分应用，默认是以其使用者的身份来启动容器的，因为使用者的权限不同，所以容器能访问的资源也不同。所以在Zone内，即使是同一个dApp,不同用户的使用的dApp也是运行在不同的容器中的。

这种隔离也为用户运行不同版本的dApp提供了可能性。


#### 总结

多用户的支持设计到BuckyOS的ACL基础机制的设计，各个基础服务对ACL机制的支持，以及在此基础上细致而合理的配置。是一个精细的工作。

## 二、多用户管理的UI

多用户管理的UI相对比较传统，我们的多用户管理使用ACL作为底层，因此UI上的基本逻辑也是符合ACL的一贯逻辑的。

### 用户信息一览

可以看到自己的账号信息
也可以看到存在的其它账号信息
点击其它账号，可以看到其它账号的详细信息


### 创建账号

引导创建，流程如下：

1. 选择创建普通账号还是受限账号
2. 输入必要的账号信息
3. 输入认证方式，可以选择：立刻创建密码（纯本地用户）或产生邀请链接.邀请链接允许拥有链接的人按流程关联自己的已有账号。
   使用邀请链接是默认选项，其流程意义是邀请一个DID加入Zone.
4. 如果是普通账号，可以选择是否是管理员账号
5. Review账号信息，确认创建
6. 普通本地用户可以升级成DID用户，但不可以降级成本地用户

### 修改账号信息


### 更换账号的秘钥

更换秘钥是否有隐患？

### 删除账号
Bac

### 配置账号权限


## 三、普通账号的迁移

在Zone内的普通账号，可以复制到另一个Zone内（需要另一个Zone做好接收准备）。复制成功后，可以基本保持原有的体验。

访问一个人的个人主页有两种方式，一种是

http://$did.phome.buckyos.org/ 此时会根据用户的默认zone配置，跳到

http://$did.homes.$zoneid/ 这个地址是用户在某个zone的个人主页。
对普通用户来说，$did就是$zoneid，申请$did的过程就是申请zoneid的过程（每个人都需要一个全网唯一的，可读的名字）。
但基于友好名字的$did是有维护成本的，而 $did@$zoneid 的维护成本更低。
bns合约在设计的时候，应该对大部分用户来说，友好$did都是没有维护成本的。


### 从Web2.5迁移到Web3 (DID)


## 四、启用家长控制
（暂不支持）

## 五、启用老人友好设置
（暂不支持）
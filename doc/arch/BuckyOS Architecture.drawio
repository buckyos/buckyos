<mxfile host="65bd71144e" pages="12">
    <diagram id="oIMGCOtcYAl4cptAXmcz" name="Architecture">
        <mxGraphModel dx="1489" dy="801" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="MFu4L8sQsqwjJeb4Q1V4-1" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;" parent="1" source="slN-2MWBcHAUPgdGicAb-35" target="slN-2MWBcHAUPgdGicAb-11" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="1120" y="730" as="sourcePoint"/>
                        <mxPoint x="201" y="729" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="lFBDZCVjJiKcxowxsO6f-2" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;" parent="1" source="MFu4L8sQsqwjJeb4Q1V4-2" target="slN-2MWBcHAUPgdGicAb-12" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="1120" y="730" as="sourcePoint"/>
                        <mxPoint x="-130" y="732" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-36" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;" parent="1" source="slN-2MWBcHAUPgdGicAb-12" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="1120" y="732" as="sourcePoint"/>
                        <mxPoint x="-150" y="729" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-3" value="etcd" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="466" y="850" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-9" value="system_config" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="466" y="780" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-10" value="pkg_loader" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="661" y="780" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-22" value="app service container" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
                    <mxGeometry x="616" y="430" width="120" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-23" value="app1 service" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="626" y="470" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-24" value="kRPC" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=0" parent="1" vertex="1">
                    <mxGeometry x="346" y="640" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-25" value="scheduler" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=0" parent="1" vertex="1">
                    <mxGeometry x="631" y="640" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-26" value="app service container" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
                    <mxGeometry x="486" y="430" width="120" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-27" value="app2 service" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="496" y="470" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-30" value="app service vm" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
                    <mxGeometry x="346" y="430" width="120" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-31" value="app3 service@vm" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="356" y="470" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-32" value="DCFS&lt;br&gt;(Name Data Mgr)" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="215" y="704" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-33" value="user-library" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=2" parent="1" vertex="1">
                    <mxGeometry x="85" y="570" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-37" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;" parent="1" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="1120" y="540" as="sourcePoint"/>
                        <mxPoint x="-130" y="540" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-38" value="k8s&lt;br&gt;(3rd service)" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=2" parent="1" vertex="1">
                    <mxGeometry x="486" y="570" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-39" value="repo-service" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=2" parent="1" vertex="1">
                    <mxGeometry x="631" y="570" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-43" value="control-panel" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=0" parent="1" vertex="1">
                    <mxGeometry x="820" y="640" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="LSNKY13j9HE2RUXXMu7w-2" value="system-repair" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=0" parent="1" vertex="1">
                    <mxGeometry x="980" y="640" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="LSNKY13j9HE2RUXXMu7w-4" value="kLog" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="481" y="640" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="LSNKY13j9HE2RUXXMu7w-6" value="smb" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=2" parent="1" vertex="1">
                    <mxGeometry x="215" y="570" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="LSNKY13j9HE2RUXXMu7w-7" value="file-sync" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=2" parent="1" vertex="1">
                    <mxGeometry x="346" y="570" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-12" value="cyfs-gateway" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="81" y="704" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="lFBDZCVjJiKcxowxsO6f-3" value="用户应用：" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="-129" y="430" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="lFBDZCVjJiKcxowxsO6f-4" value="系统框架（内核）服务：" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="-140" y="544" width="220" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="lFBDZCVjJiKcxowxsO6f-5" value="内核模型：" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="-135" y="730" width="220" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="lFBDZCVjJiKcxowxsO6f-6" value="&lt;div&gt;内核模型（Kernel Models）不可扩展。该层的目的是为内核服务（Kernel Service）准备运行环境。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;作为系统最基础的组成部分，它应尽快进入稳定状态，因此应尽量减少对该层的修改。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;该层的一些基础组件可以加载系统插件（System Plugin）来扩展功能，例如 pkg_loader 可以通过预定义的 SystemPlugin 支持新的包下载协议。&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="-135" y="753" width="194" height="257" as="geometry"/>
                </mxCell>
                <mxCell id="lFBDZCVjJiKcxowxsO6f-10" value="Frame-Service 是系统的内核态服务，通过内核 RPC 将系统能力暴露给用户态。&lt;br&gt;&lt;br&gt;它可以在系统管理员的操作下进行扩展，扩展逻辑类似于在 Linux 中安装新的内核模块（kmod）。" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="-134" y="566" width="215" height="140" as="geometry"/>
                </mxCell>
                <mxCell id="lFBDZCVjJiKcxowxsO6f-11" value="由用户日常管理、在用户态运行的应用服务。" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="-129" y="456" width="190" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="lFBDZCVjJiKcxowxsO6f-12" value="rdb？" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;dashPattern=8 8;" parent="1" vertex="1">
                    <mxGeometry x="81" y="640" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-11" value="node_daemon" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="540" y="704" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="MFu4L8sQsqwjJeb4Q1V4-3" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;" parent="1" source="slN-2MWBcHAUPgdGicAb-11" target="MFu4L8sQsqwjJeb4Q1V4-2" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="486" y="731" as="sourcePoint"/>
                        <mxPoint x="201" y="729" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="MFu4L8sQsqwjJeb4Q1V4-2" value="name-client" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="348" y="706" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="6-1yxfffDUMwKPKJ0_kN-17" value="返回请求" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1320" y="5340" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="2" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;" parent="1" target="slN-2MWBcHAUPgdGicAb-35" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="1120" y="730" as="sourcePoint"/>
                        <mxPoint x="660" y="729" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="slN-2MWBcHAUPgdGicAb-35" value="verify_hub" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="820" y="700" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="3" value="DNS" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="290" y="1030" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="4" value="BNS&lt;div&gt;（Smart Contract)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="436" y="1030" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="5" value="SN&lt;div&gt;(Web3 Bridge)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="588" y="1030" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="6" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;" parent="1" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="1140" y="1020" as="sourcePoint"/>
                        <mxPoint x="-110" y="1020" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LSNKY13j9HE2RUXXMu7w-3" value="node-reporter" style="rounded=1;whiteSpace=wrap;html=1;fontStyle=0" parent="1" vertex="1">
                    <mxGeometry x="980" y="704" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="8" value="备份服务" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="900" y="1030" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="9" value="去中心化存储" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1050" y="1030" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="10" value="Zone 外基础设施" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="-134" y="1030" width="220" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="11" value="Zone 外部的基础设施可以解决系统启动问题，并为跨 Zone 通信提供可靠保障。BuckyOS 依赖的全局基础设施将演进为去中心化的基础设施，不依赖任何特定的基础设施。" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="-134" y="1050" width="234" height="139" as="geometry"/>
                </mxCell>
                <mxCell id="12" value="加密支付协议" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="736" y="1030" width="120" height="50" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram id="iOcJLOFx5TQZdEkecl_a" name="kernel loop">
        <mxGraphModel dx="2278" dy="801" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-48" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="-695" y="2181" width="170" height="358.05" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-34" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="-10" y="1495.63" width="430" height="496.25" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="lypH9cc-xeRXDXk-d7uY-21" target="fsqWt6HOSnuXdC4bvL9f-3" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-585" y="1970" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-21" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="-730" y="1610" width="290" height="320" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-29" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="w76EHTxTQfi9PKH68CeN-25" target="w76EHTxTQfi9PKH68CeN-26" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-25" value="exec node_op_tasks" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=0" parent="1" vertex="1">
                    <mxGeometry x="-405" y="2460" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-30" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="w76EHTxTQfi9PKH68CeN-26" target="w76EHTxTQfi9PKH68CeN-27" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-26" value="contrl frame_service at this node to target state" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=0" parent="1" vertex="1">
                    <mxGeometry x="-405" y="2560" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="w76EHTxTQfi9PKH68CeN-27" target="w76EHTxTQfi9PKH68CeN-33" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="-200" y="2690"/>
                            <mxPoint x="-200" y="2290"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-27" value="contrl app_service at this node to target state" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=0" parent="1" vertex="1">
                    <mxGeometry x="-405" y="2660" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-35" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="w76EHTxTQfi9PKH68CeN-33" target="w76EHTxTQfi9PKH68CeN-47" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-345" y="2360" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-33" value="read node_config&lt;br&gt;from system_config_service" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="-422.5" y="2260" width="155" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-51" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="w76EHTxTQfi9PKH68CeN-47" target="w76EHTxTQfi9PKH68CeN-25" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="w76EHTxTQfi9PKH68CeN-47" target="fsqWt6HOSnuXdC4bvL9f-46" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-47" value="apply cyfs-gateway config from node_config" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=0" parent="1" vertex="1">
                    <mxGeometry x="-405" y="2370" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-75" value="System(Zone) Topology Changed&lt;div&gt;（Node Changed)&lt;/div&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;" parent="1" vertex="1">
                    <mxGeometry x="189.95" y="2411.95" width="160" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-76" value="Discover known faults through kLog" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;" parent="1" vertex="1">
                    <mxGeometry x="9.949999999999989" y="2411.95" width="160" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-77" value="Pod Changed (like new service installed)&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;" parent="1" vertex="1">
                    <mxGeometry x="369.95" y="2411.95" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-86" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="w76EHTxTQfi9PKH68CeN-78" target="w76EHTxTQfi9PKH68CeN-80" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-78" value="do kernel scheduling" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="179.95" y="2551.95" width="160" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-87" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="w76EHTxTQfi9PKH68CeN-80" target="w76EHTxTQfi9PKH68CeN-81" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-80" value="Generate new nodes_config&lt;br&gt;(sometimes node_op_task included)" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;" parent="1" vertex="1">
                    <mxGeometry x="169.95" y="2659.95" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-89" value="Pass" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="w76EHTxTQfi9PKH68CeN-81" target="w76EHTxTQfi9PKH68CeN-88" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="259.95" y="2906.95"/>
                            <mxPoint x="259.95" y="2906.95"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-96" value="No" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="w76EHTxTQfi9PKH68CeN-81" target="w76EHTxTQfi9PKH68CeN-90" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-81" value="Check the nodes_config &lt;br&gt;with user-defined &lt;br&gt;post-processing logic." style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="152.45" y="2776.95" width="215" height="110" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-82" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.471;exitY=0.997;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;" parent="1" source="w76EHTxTQfi9PKH68CeN-76" target="w76EHTxTQfi9PKH68CeN-78" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="89.94999999999999" y="2566.95" as="sourcePoint"/>
                        <mxPoint x="139.95" y="2516.95" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-83" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.567;entryY=0.035;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="w76EHTxTQfi9PKH68CeN-75" target="w76EHTxTQfi9PKH68CeN-78" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-85" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.8;entryY=0.02;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="w76EHTxTQfi9PKH68CeN-77" target="w76EHTxTQfi9PKH68CeN-78" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="409.95" y="2586.95" as="sourcePoint"/>
                        <mxPoint x="459.95" y="2536.95" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-95" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="w76EHTxTQfi9PKH68CeN-88" target="w76EHTxTQfi9PKH68CeN-91" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-30.05000000000001" y="2234.95" as="targetPoint"/>
                        <Array as="points">
                            <mxPoint x="619.95" y="2964.95"/>
                            <mxPoint x="619.95" y="2239.95"/>
                            <mxPoint x="269.95" y="2239.95"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-99" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;dashPattern=8 8;" parent="1" source="w76EHTxTQfi9PKH68CeN-88" target="w76EHTxTQfi9PKH68CeN-97" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-88" value="update nodes_config to etcd" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;" parent="1" vertex="1">
                    <mxGeometry x="169.95" y="2956.95" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-90" value="Call the system administrator for assistance." style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="459.95" y="2791.95" width="120" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-92" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;" parent="1" source="w76EHTxTQfi9PKH68CeN-91" target="w76EHTxTQfi9PKH68CeN-76" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-93" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="w76EHTxTQfi9PKH68CeN-91" target="w76EHTxTQfi9PKH68CeN-75" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-94" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;" parent="1" source="w76EHTxTQfi9PKH68CeN-91" target="w76EHTxTQfi9PKH68CeN-77" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-91" value="start&lt;br&gt;wait events" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="209.95" y="2281.95" width="120" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-43" value="Update node_config" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;dashed=1;dashPattern=12 12;" parent="1" source="w76EHTxTQfi9PKH68CeN-97" target="w76EHTxTQfi9PKH68CeN-33" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="-50" y="3117"/>
                            <mxPoint x="-50" y="2275"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-97" value="Nodes with changed node_config will execute actions according to the new status." style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="199.95" y="3076.95" width="120" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="w76EHTxTQfi9PKH68CeN-102" value="调度循环 @scheduler 服务：" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=14;" parent="1" vertex="1">
                    <mxGeometry x="-29.05000000000001" y="2244.95" width="270" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-1" value="节点循环 @node_daemon：" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=14;" parent="1" vertex="1">
                    <mxGeometry x="-470" y="1090" width="230" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-2" value="Y" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="lypH9cc-xeRXDXk-d7uY-4" target="lypH9cc-xeRXDXk-d7uY-5" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-3" value="No" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="lypH9cc-xeRXDXk-d7uY-4" target="lypH9cc-xeRXDXk-d7uY-8" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="-440" y="1254.25"/>
                            <mxPoint x="-440" y="1254.25"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-4" value="load node_identity?" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-420" y="1210.75" width="150" height="87.5" as="geometry"/>
                </mxCell>
                <mxCell id="O63FZA-lGS3qpQbuYNQ6-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="lypH9cc-xeRXDXk-d7uY-5" target="O63FZA-lGS3qpQbuYNQ6-1" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-5" value="load zone_boot_config&lt;div&gt;from NameService&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="-405" y="1327.75" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="lypH9cc-xeRXDXk-d7uY-7" target="lypH9cc-xeRXDXk-d7uY-4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-7" value="start" style="strokeWidth=1;html=1;shape=mxgraph.flowchart.start_1;whiteSpace=wrap;fontStyle=0" parent="1" vertex="1">
                    <mxGeometry x="-395" y="1114.25" width="100" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-8" value="node would enter wait active state" style="strokeWidth=1;html=1;shape=mxgraph.flowchart.terminator;whiteSpace=wrap;" parent="1" vertex="1">
                    <mxGeometry x="-580" y="1224.5" width="100" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-19" value="No! Looking for any OOD&lt;div&gt;(Cache enable)&lt;/div&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="lypH9cc-xeRXDXk-d7uY-10" target="lypH9cc-xeRXDXk-d7uY-21" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="lypH9cc-xeRXDXk-d7uY-10" target="lypH9cc-xeRXDXk-d7uY-27" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-10" value="Am I OOD?&lt;div&gt;Is Node in ooldlist&lt;/div&gt;" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-420" y="1510" width="150" height="87.5" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-13" value="OOD 不可移植。局域网（LAN）变化需要重建 device_config，并且需要用户签名。" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
                    <mxGeometry x="-650" y="1410" width="200" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-15" value="looking for Same-LAN OOD by UDP broadcast&amp;nbsp;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-720" y="1620" width="270" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-16" value="looking for OOD by local-DNS ($oodname.local)" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-720" y="1695" width="270" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-17" value="looking for OOD by TCP scan" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-720" y="1767.5" width="270" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-18" value="&lt;div&gt;looking for OOD by Zone-Gateway&lt;/div&gt;rtcp://$zoneid&lt;div&gt;/$oodname:22080&lt;div&gt;rtcp://$sn/$oodname:22080&lt;br&gt;&lt;div&gt;resolve $zoneid support bns&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-720" y="1840" width="270" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-48" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="lypH9cc-xeRXDXk-d7uY-27" target="lypH9cc-xeRXDXk-d7uY-28" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-152.5" y="1690" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-27" value="start system_config_service" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-225" y="1640" width="145" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="lypH9cc-xeRXDXk-d7uY-28" target="lypH9cc-xeRXDXk-d7uY-29" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-28" value="sync N+1 system_config service ready" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-225" y="1750" width="145" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-32" value="Yes" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="lypH9cc-xeRXDXk-d7uY-29" target="lypH9cc-xeRXDXk-d7uY-31" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-38" value="No" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="lypH9cc-xeRXDXk-d7uY-29" target="lypH9cc-xeRXDXk-d7uY-37" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-29" value="First Boot?&lt;div&gt;(check kv://boot/config)&lt;/div&gt;" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-241.25" y="1840" width="167.5" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-30" value="自动执行 system_config_service 恢复？" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
                    <mxGeometry x="-366.25" y="1637.5" width="130" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="lypH9cc-xeRXDXk-d7uY-31" target="lypH9cc-xeRXDXk-d7uY-37" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-31" value="do boot scheuler&lt;div&gt;create kv://boot/config&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-420" y="1860" width="145" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-37" value="Connect to local system_config_service and load ZoneConfig" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-230" y="2000" width="145" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="lypH9cc-xeRXDXk-d7uY-41" target="w76EHTxTQfi9PKH68CeN-33" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-41" value="Node&lt;div&gt;Boot OK&lt;/div&gt;" style="strokeWidth=1;html=1;shape=mxgraph.flowchart.start_1;whiteSpace=wrap;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="-395" y="2100" width="100" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="fsqWt6HOSnuXdC4bvL9f-3" target="lypH9cc-xeRXDXk-d7uY-41" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="-585" y="2040" as="sourcePoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="lypH9cc-xeRXDXk-d7uY-37" target="lypH9cc-xeRXDXk-d7uY-41" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lypH9cc-xeRXDXk-d7uY-45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.25;exitDx=0;exitDy=0;entryX=0.998;entryY=0.357;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="lypH9cc-xeRXDXk-d7uY-28" target="lypH9cc-xeRXDXk-d7uY-21" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-3" value="Connect to system_config_service and load ZoneConfig" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-645" y="2020" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-27" value="No" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="fsqWt6HOSnuXdC4bvL9f-5" target="fsqWt6HOSnuXdC4bvL9f-6" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-33" value="Yes" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="fsqWt6HOSnuXdC4bvL9f-5" target="fsqWt6HOSnuXdC4bvL9f-32" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-5" value="Is WLAN OOD?" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="85" y="1550" width="150" height="87.5" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-30" value="Y" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="fsqWt6HOSnuXdC4bvL9f-6" target="fsqWt6HOSnuXdC4bvL9f-25" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-31" value="N" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="fsqWt6HOSnuXdC4bvL9f-6" target="fsqWt6HOSnuXdC4bvL9f-28" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-6" value="Need SN?" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="85" y="1700" width="150" height="87.5" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-7" value="boot阶段的cyfs-gateway作用：支持连接到system_config_service&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. 非WLAN节点，让etcd有机会联通别的NAT后面的OOD&lt;/div&gt;&lt;div&gt;2. WLAN节点，特殊的zone-gateway,支持其它的OOD通过本节点，联通其它NAT后面的OOD&lt;/div&gt;&lt;div&gt;3. SN节点是外部的一个rtcp协议栈，不是zone内的OOD&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="-5" y="1110" width="430" height="89" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-8" value="OOD3@WLAN" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="570" y="1164" width="120" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-10" value="OOD1@LAN1" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="450" y="1272" width="120" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-11" value="OOD5@LAN2" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="699" y="1272" width="120" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-12" value="OOD2@LAN1" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="450" y="1381" width="120" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-13" value="OOD4@LAN1" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="450" y="1481" width="120" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-14" value="N+1=3&lt;div&gt;每个OOD要连接至少2个OOD才能Boot成功&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="450" y="1211" width="111" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-16" value="OOD1：与 OOD3 保持隧道&lt;div&gt;直连到 OOD3、OOD2、OOD4&lt;/div&gt;&lt;div&gt;通过 rtcp 连接到 OOD5&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;OOD2：与 OOD3 保持隧道&lt;div&gt;直连到 OOD3、OOD2、OOD4&lt;/div&gt;&lt;div&gt;通过 rtcp 连接到 OOD5&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;OOD4：与 OOD3 保持隧道&lt;div&gt;直连到 OOD3、OOD2、OOD4&lt;/div&gt;&lt;div&gt;通过 rtcp 连接到 OOD5&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;OOD3：&lt;/div&gt;&lt;div&gt;通过 rtcp 连接到 OOD1、OOD2、OOD4、OOD5&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;OOD5：与 OOD3 保持隧道&lt;/div&gt;&lt;div&gt;直连到 OOD3&lt;/div&gt;&lt;div&gt;通过 rtcp 连接到 OOD1、OOD2、OOD5&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="638.5" y="1381" width="221" height="290" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-17" value="SN@WLAN" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="590" y="1710" width="120" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-18" value="OOD1@LAN1" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="450" y="1811" width="120" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-19" value="OOD3@LAN2" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="699" y="1811" width="120" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-20" value="OOD2@LAN1" style="ellipse;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="450" y="1920" width="120" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-22" value="N+1=2&lt;div&gt;每个OOD要连接至少2个OOD才能Boot成功&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="450" y="1750" width="111" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-23" value="OOD1：与 SN 保持隧道&lt;div&gt;直连到 OOD2&lt;/div&gt;&lt;div&gt;通过 rtcp 连接到 OOD3&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;OOD2：与 SN 保持隧道&lt;div&gt;直连到 OOD3、OOD2、OOD4&lt;/div&gt;&lt;div&gt;通过 rtcp 连接到 OOD5&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;OOD4：与 OOD3 保持隧道&lt;div&gt;直连到 OOD3、OOD2、OOD4&lt;/div&gt;&lt;div&gt;通过 rtcp 连接到 OOD5&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;OOD3：&lt;/div&gt;&lt;div&gt;通过 rtcp 连接到 OOD1、OOD2、OOD4、OOD5&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;OOD5：与 OOD3 保持隧道&lt;/div&gt;&lt;div&gt;直连到 OOD3&lt;/div&gt;&lt;div&gt;通过 rtcp 连接到 OOD1、OOD2、OOD5&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="620" y="1920" width="221" height="290" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-24" value="create dispatch config:&lt;div&gt;local port -&amp;gt; rtcp://$sn/$oodid:20080&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry y="1910" width="130" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="O63FZA-lGS3qpQbuYNQ6-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="fsqWt6HOSnuXdC4bvL9f-25" target="fsqWt6HOSnuXdC4bvL9f-24" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-25" value="keep tunnel to SN" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry y="1820" width="130" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="O63FZA-lGS3qpQbuYNQ6-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="fsqWt6HOSnuXdC4bvL9f-28" target="fsqWt6HOSnuXdC4bvL9f-29" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-28" value="keep tunnel to WLAN OOD（zone-gateway)" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="214" y="1822.5" width="130" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-29" value="create dispatch config:&lt;div&gt;local port -&amp;gt; rtcp://$zonegateway/$oodid:20080&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="214" y="1910" width="130" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-32" value="create dispatch config:&lt;div&gt;local port -&amp;gt; rtcp:///$oodid:20080&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="285" y="1563.75" width="130" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="FtUDA4jLs7bKUEtVHcqN-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="fsqWt6HOSnuXdC4bvL9f-36" target="fsqWt6HOSnuXdC4bvL9f-34" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-36" value="cyfs-gateway Loop" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;dashed=1;verticalAlign=top;" parent="1" vertex="1">
                    <mxGeometry x="85" y="1211" width="170" height="253.5" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-37" value="if this is ood&lt;br&gt;keep tunnel to SN/WLAN OOD" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=0" parent="1" vertex="1">
                    <mxGeometry x="115" y="1316.75" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-38" value="create tcp-&amp;gt;rtcp for kernel service" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=0" parent="1" vertex="1">
                    <mxGeometry x="115" y="1387.75" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-39" value="if zone.sn exists,try register OOD to SN" style="rounded=0;whiteSpace=wrap;html=1;fontStyle=0" parent="1" vertex="1">
                    <mxGeometry x="115" y="1247.75" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-44" value="boot_gateway_config" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-675" y="2288.05" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-45" value="user_gateway_config" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-675" y="2209.05" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-46" value="node_gateway_config" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" parent="1" vertex="1">
                    <mxGeometry x="-675" y="2369.05" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-47" value="post_gateway_config" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-675" y="2458.05" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="fsqWt6HOSnuXdC4bvL9f-50" value="cyfs-gateway 配置规则" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="-695" y="2187.05" width="155" height="15" as="geometry"/>
                </mxCell>
                <mxCell id="O63FZA-lGS3qpQbuYNQ6-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="O63FZA-lGS3qpQbuYNQ6-1" target="lypH9cc-xeRXDXk-d7uY-10" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="O63FZA-lGS3qpQbuYNQ6-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="O63FZA-lGS3qpQbuYNQ6-1" target="fsqWt6HOSnuXdC4bvL9f-36" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="O63FZA-lGS3qpQbuYNQ6-1" value="start cyfs-gateway at boot-model (support system_config can be found)" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-417.5" y="1420" width="145" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="yaLFH_EoCBhOSX-8fva--1" value="boot阶段用ood string初始化rtcp tunnel的身份问题？" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fillColor=#fff2cc;strokeColor=#d6b656;" parent="1" vertex="1">
                    <mxGeometry x="-110" y="1238.25" width="130" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="lQr_6oz8xkaGaNCxREZ9-1" value="从 Zone-Gateway 获取 Zone 配置以优化流程" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="-810" y="1519.63" width="190" height="68.25" as="geometry"/>
                </mxCell>
                <mxCell id="lQr_6oz8xkaGaNCxREZ9-2" value="&lt;div&gt;&lt;b style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;站在非OOD的视角：&lt;/b&gt;&lt;/div&gt;system config的http url:&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;先通过http://zonehost/ 得到详细的，包含有所有ood ip的zone-info&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;http://OOD_IP:3200/kapi/system-config&lt;/span&gt;&lt;/div&gt;&lt;div&gt;运行在非OOD上的服务，通过得到OOD的IP，来稳定的访问某个OOD上的system config&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;http://127.0.0.1/kapi/system-config&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;运行在非OOD上的服务，&lt;/span&gt;使用本地cyfs-gateway提供的服务发现机制，来连接无法直接连接（在另一个NAT后面）的system config. 这个访问总是能成功的&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;http://zonehost/kapi/system-config&lt;/div&gt;&lt;div&gt;运行在非OOD上的服务，使用zone-gateway提供的服务发现机制，来连接system config.这个请求总是能成功的（给页面使用），为了保护zone-gateway的性能，有条件的runtime总是在最后才使用这个url&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;其它service的url (服务发现）&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;先通过system-config得到service-info,了解有多少个instance. 在多ood系统里，访问system-config没有单点故障&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;然后选择最佳的instance进行连接&lt;/div&gt;&lt;div&gt;instance信息里有地址信息，是service启动后创建的，包含真实的端口信息&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;如果选择的是instance在NAT后，则必须访问本地cyfsgateway的URL，（cyfs-gateway本身会创建映射过去）&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;http://127.0.0.1:service_port/kapi/service-name&lt;/div&gt;&lt;div&gt;如果可以，优先选择在相同node的服务&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;http://node_ip:service_port/kapi/service-name&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;http://127.0.0.1/kapi/service-name&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;http://zonehost/kapiservice-name&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;zonehost里可以包含端口&lt;/div&gt;&lt;div&gt;zone boot配置里是否需要rtcp stack port?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;非OOD是否要与公网OOD keep tunnel?&lt;/div&gt;&lt;div&gt;要的&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="990" y="1147.75" width="315" height="772.25" as="geometry"/>
                </mxCell>
                <mxCell id="lQr_6oz8xkaGaNCxREZ9-4" value="&lt;b&gt;站在OOD的视角&lt;/b&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;便写好正确的boot_gateway配置，让cyfs-gateway提供正确的端口，以实现etcd 之间的互相sync&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;etcd成功连接后，node_daemon 还是连接本机的system-config&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;ood keep-tunnel with other-ood的方法&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;与SN Keep tunnel(只有一个）&lt;/div&gt;&lt;div&gt;与标识为WLAN的OODkeep tunnel(必定有IP）&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. get wan-ip from boot-config&lt;/div&gt;&lt;div&gt;2. open rtcp tunnel to rtcp://wan-ip:rtcp port&lt;br&gt;&amp;nbsp; &amp;nbsp; 握手过程可以传递私钥？&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;boot zonfig中的信息&lt;/div&gt;&lt;div&gt;a. owner pub key&lt;/div&gt;&lt;div&gt;b. gateway-pub key (可能是SN，也可能是OOD），握手后可知道信息&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1350" y="1161.5" width="315" height="436" as="geometry"/>
                </mxCell>
                <mxCell id="cgIGTQRAsnV8DeNC6tyR-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="cgIGTQRAsnV8DeNC6tyR-1" target="cgIGTQRAsnV8DeNC6tyR-2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="cgIGTQRAsnV8DeNC6tyR-1" value="ZoneBootConfig" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=default;" parent="1" vertex="1">
                    <mxGeometry x="1170" y="2040" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="cgIGTQRAsnV8DeNC6tyR-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="cgIGTQRAsnV8DeNC6tyR-2" target="cgIGTQRAsnV8DeNC6tyR-4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="cgIGTQRAsnV8DeNC6tyR-2" value="Scan/Load Cache&lt;div&gt;to get OODInfo&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=default;" parent="1" vertex="1">
                    <mxGeometry x="1170" y="2160" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="cgIGTQRAsnV8DeNC6tyR-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="cgIGTQRAsnV8DeNC6tyR-3" target="cgIGTQRAsnV8DeNC6tyR-5" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="cgIGTQRAsnV8DeNC6tyR-3" value="ZoneBootInfo&lt;div&gt;（write cache）&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=default;" parent="1" vertex="1">
                    <mxGeometry x="1170" y="2400" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="cgIGTQRAsnV8DeNC6tyR-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="cgIGTQRAsnV8DeNC6tyR-4" target="cgIGTQRAsnV8DeNC6tyR-3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="cgIGTQRAsnV8DeNC6tyR-4" value="Boot&lt;div&gt;(Connect to sys_config_servcie)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=default;align=center;verticalAlign=middle;fontFamily=Helvetica;fontSize=12;fontColor=default;fillColor=default;" parent="1" vertex="1">
                    <mxGeometry x="1170" y="2281.9500000000003" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="cgIGTQRAsnV8DeNC6tyR-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="cgIGTQRAsnV8DeNC6tyR-5" target="cgIGTQRAsnV8DeNC6tyR-3" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="1230" y="2600"/>
                            <mxPoint x="1120" y="2600"/>
                            <mxPoint x="1120" y="2430"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="cgIGTQRAsnV8DeNC6tyR-5" value="keep alive&lt;div&gt;(refresh zone boot info from sys_config_service)&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1170" y="2510" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="cgIGTQRAsnV8DeNC6tyR-18" value="获取 System-Config-client" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1155" y="1991.88" width="150" height="30" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram id="1u5XhRc6Ss8xfa0_lFwo" name="Service &amp; kRPC">
        <mxGraphModel dx="1428" dy="801" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="TtpUKM4LW4xhPhtb8Lpu-19" value="kRPC" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="1VOikts_Fu2gLfuLLnL2-2" target="TtpUKM4LW4xhPhtb8Lpu-18" edge="1">
                    <mxGeometry x="0.3333" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-15" value="http&lt;div&gt;4.1&lt;/div&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TtpUKM4LW4xhPhtb8Lpu-19" vertex="1" connectable="0">
                    <mxGeometry x="-0.3476" y="-3" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="1VOikts_Fu2gLfuLLnL2-2" value="Kernel Service" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="140" y="790" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="1VOikts_Fu2gLfuLLnL2-3" value="App" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="140" y="640" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="TtpUKM4LW4xhPhtb8Lpu-5" value="4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="TtpUKM4LW4xhPhtb8Lpu-1" target="1VOikts_Fu2gLfuLLnL2-2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-14" value="http" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="TtpUKM4LW4xhPhtb8Lpu-5" vertex="1" connectable="0">
                    <mxGeometry x="-0.3653" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-9" value="5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;" parent="1" source="TtpUKM4LW4xhPhtb8Lpu-1" target="-N7vmcvN1w1kGffq8Vgl-1" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-16" value="http 5" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="-N7vmcvN1w1kGffq8Vgl-9" vertex="1" connectable="0">
                    <mxGeometry x="-0.0472" y="1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="TtpUKM4LW4xhPhtb8Lpu-1" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;dashed=1;dashPattern=8 8;" parent="1" vertex="1">
                    <mxGeometry x="117.5" y="590" width="165" height="130" as="geometry"/>
                </mxCell>
                <mxCell id="TtpUKM4LW4xhPhtb8Lpu-2" value="应用运行时" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="117.5" y="600" width="102.5" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="TtpUKM4LW4xhPhtb8Lpu-11" value="u:root" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="1" vertex="1">
                    <mxGeometry x="117.5" y="810" width="30" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="TtpUKM4LW4xhPhtb8Lpu-15" value="u:appid" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="1" vertex="1">
                    <mxGeometry x="110" y="690" width="30" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="TtpUKM4LW4xhPhtb8Lpu-18" value="Kernel Service2" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="140" y="930" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="bFMGxiHM1td_q0ntUE2M-1" value="&lt;b&gt;kRPC的权限管理&lt;/b&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. 服务开发者总是要对session token进行校验&lt;/div&gt;&lt;div&gt;2. 基本原则：zone内可以直连，zone外需要通过zone-gateway连接&lt;/div&gt;&lt;div style=&quot;&quot;&gt;3. 公网OOD的app服务通常是绑定127.0.0.1的，这样可以利用cyfs-gateway做防火墙，防止直接暴露. 非公网OOD的服务也只有内网有机会访问&lt;/div&gt;&lt;div&gt;4. 应用服务总是运行在逻辑容器中，这样即使出现漏洞，其能泄露的数据也可以控制在App范围内。&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="590" y="10" width="310" height="170" as="geometry"/>
                </mxCell>
                <mxCell id="jygwpOhVrun2l0I2vdN9-1" value="1.服务发现&lt;div&gt;2. 服务的公网URL&lt;/div&gt;&lt;div&gt;3.服务的基本安全机制&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;服务发现&lt;/b&gt;是指系统提供的一种标准机制，能根据系统的当前配置，将请求路由到正确的node上的app/frame service中。标准的服务发现依赖可用的system_config服务，并根据当前的系统状况，跳过失效的node,并根据node实时负载情况，调整无状态服务的请求的投递权重。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Zone内访问服务的方法&lt;/b&gt;&lt;/div&gt;&lt;div&gt;1. 使用标准的服务client访问，系统有机会让该调用变成一个进程内的function call&lt;/div&gt;&lt;div&gt;2. 基于 http://127.0.0.1:$service_port/ 建立krcp client，并发起访问，绝对没有跨node的网络流量。该请求直接到service&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3. 兼容性最好：基于 http://127.0.0.1/kapi/$servicename 建立krpc client, cyfs-gateway会在内部实现服务发现，并自动基于rtcp://实现跨nat的服务访问 .该请求可能会进过2-3次转发到达service&lt;/div&gt;&lt;div&gt;（优先实现）&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;4. 基于buckyos-sdk的服务发现api建立krpclient （cyfs-gateway内部也使用这个api)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;5. 使用公网的 https://zonegateway/kapi/$servicename 建立krpc client&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Zone外访问服务的方法&lt;/b&gt;&lt;/div&gt;&lt;div&gt;https://$appid.$zoneid/&lt;/div&gt;&lt;div&gt;&lt;div&gt;https://$zoneid/kapi/$servicename (需要支持跨域？）&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;https://$appid.$zoneid/kapi/$servicename (不需要跨域，但app需要声明自己的app page需要访问的服务）&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="118" y="22" width="367" height="482" as="geometry"/>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-10" value="6 rtcp" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-N7vmcvN1w1kGffq8Vgl-1" target="-N7vmcvN1w1kGffq8Vgl-3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-1" value="OOD1 cyfs-gateway" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="350" y="790" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-2" value="Kernel Service" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="870" y="790" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-7" value="2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;" parent="1" source="-N7vmcvN1w1kGffq8Vgl-3" target="-N7vmcvN1w1kGffq8Vgl-1" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-12" value="rtcp" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="-N7vmcvN1w1kGffq8Vgl-7" vertex="1" connectable="0">
                    <mxGeometry x="-0.5023" y="1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-18" value="7 rtcp" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-N7vmcvN1w1kGffq8Vgl-3" target="-N7vmcvN1w1kGffq8Vgl-17" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-3" value="zone-gateway" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="460" y="630" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-5" value="1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-N7vmcvN1w1kGffq8Vgl-4" target="-N7vmcvN1w1kGffq8Vgl-3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-11" value="http" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="-N7vmcvN1w1kGffq8Vgl-5" vertex="1" connectable="0">
                    <mxGeometry x="0.3333" y="-2" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-4" value="浏览器" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="670" y="630" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-8" value="3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=0;exitDx=0;exitDy=0;entryX=1.006;entryY=0.539;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="-N7vmcvN1w1kGffq8Vgl-1" target="TtpUKM4LW4xhPhtb8Lpu-1" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-13" value="http" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="-N7vmcvN1w1kGffq8Vgl-8" vertex="1" connectable="0">
                    <mxGeometry x="-0.3571" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-19" value="http" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="-N7vmcvN1w1kGffq8Vgl-17" target="-N7vmcvN1w1kGffq8Vgl-2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-17" value="OOD2 cyfs-gateway" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="670" y="790" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="-N7vmcvN1w1kGffq8Vgl-20" value="浏览器发起一个请求，达到App处理，处理过程中访问了2个系统服务" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="340" y="910" width="250" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="tMAMpGZ27Te3taqgNYTz-2" target="tMAMpGZ27Te3taqgNYTz-4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-2" value="get system_config_client" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1085" y="67" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="tMAMpGZ27Te3taqgNYTz-4" target="tMAMpGZ27Te3taqgNYTz-6" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-4" value="Get Service Info&lt;div&gt;(auto cache by system_config_client)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1085" y="181.05000000000018" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="tMAMpGZ27Te3taqgNYTz-6" target="tMAMpGZ27Te3taqgNYTz-7" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-6" value="Select Service Instance" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1085" y="301.0499999999997" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-7" value="Get Service Client" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1085" y="412" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-8" value="获取其他服务客户端" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1070" y="22" width="150" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;" parent="1" source="tMAMpGZ27Te3taqgNYTz-9" target="tMAMpGZ27Te3taqgNYTz-12" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-9" value="Update Service InstanceA Info" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1360" y="65" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-10" value="Update Service InstanceB Info" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1520" y="65" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="tMAMpGZ27Te3taqgNYTz-11" target="tMAMpGZ27Te3taqgNYTz-4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-11" value="Update Service Info" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1440" y="290" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="tMAMpGZ27Te3taqgNYTz-12" target="tMAMpGZ27Te3taqgNYTz-11" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-12" value="调度算法" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1440" y="190" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="tMAMpGZ27Te3taqgNYTz-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.676;entryY=0.062;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="tMAMpGZ27Te3taqgNYTz-10" target="tMAMpGZ27Te3taqgNYTz-12" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1531" y="190" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram id="q0N88BQaiHxRkIq5dT2b" name="App Container">
        <mxGraphModel dx="2278" dy="801" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-7" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="180" y="1330" width="290" height="210" as="geometry"/>
                </mxCell>
                <mxCell id="mNxCDZtLirX5pciaZlv8-1" value="node_daemon根据App权限配置准备容器" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="70" y="40" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="mNxCDZtLirX5pciaZlv8-2" value="启动App容器" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="80" y="360" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="mNxCDZtLirX5pciaZlv8-3" value="配置环境变量&lt;br&gt;重要的权限Token" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="140" y="120" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="mNxCDZtLirX5pciaZlv8-4" value="可选：根据APP权限&lt;br&gt;创建容器文件系统&lt;br&gt;local cache&lt;br&gt;app fs" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="140" y="190" width="120" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="mNxCDZtLirX5pciaZlv8-5" value="&amp;nbsp;身份管理中心" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="490" y="200" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="mNxCDZtLirX5pciaZlv8-6" value="申请Token(按需）" style="endArrow=classic;html=1;rounded=0;exitX=1.033;exitY=0.434;exitDx=0;exitDy=0;exitPerimeter=0;entryX=-0.031;entryY=0.424;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="mNxCDZtLirX5pciaZlv8-1" target="mNxCDZtLirX5pciaZlv8-5" edge="1">
                    <mxGeometry x="0.1459" y="-4" width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="260" y="100" as="sourcePoint"/>
                        <mxPoint x="310" y="50" as="targetPoint"/>
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-1" value="可选：根据APP权限&lt;br&gt;创建容器网络" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="140" y="270" width="120" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-2" value="启动用户进程" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="140" y="430" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-3" value="初始化app sdk stub" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="140" y="500" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.002;entryY=0.584;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;" parent="1" source="mNxCDZtLirX5pciaZlv8-3" target="LHn_DE8s6H_Sm2WV2Dcl-3" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="60" y="145"/>
                            <mxPoint x="60" y="529"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-7" value="" style="endArrow=classic;html=1;rounded=0;entryX=0.25;entryY=1;entryDx=0;entryDy=0;" parent="1" target="mNxCDZtLirX5pciaZlv8-5" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="260" y="520" as="sourcePoint"/>
                        <mxPoint x="310" y="470" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-8" value="使用Token登陆，登陆成功返回session_key" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="LHn_DE8s6H_Sm2WV2Dcl-7" vertex="1" connectable="0">
                    <mxGeometry x="-0.151" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-9" value="frame service" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="650" y="580" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="LHn_DE8s6H_Sm2WV2Dcl-10" target="LHn_DE8s6H_Sm2WV2Dcl-9" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-10" value="使用kRPC调用系统功能" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="140" y="580" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-14" value="通过session_key查询调用来源的身份信息&lt;br&gt;注意session_key与from endpoint的绑定" style="endArrow=classic;html=1;rounded=0;exitX=0.551;exitY=-0.016;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.75;entryY=1;entryDx=0;entryDy=0;" parent="1" source="LHn_DE8s6H_Sm2WV2Dcl-9" target="mNxCDZtLirX5pciaZlv8-5" edge="1">
                    <mxGeometry x="-0.1108" y="-5" width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="560" y="450" as="sourcePoint"/>
                        <mxPoint x="610" y="400" as="targetPoint"/>
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-15" value="从system config中读取app的 ACL信息，进行权限控制" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="690" y="660" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-16" value="frame service如何验证调用者身份：&lt;br&gt;1. 调用中含有一个系统Owner的签名，因为系统里只有Owner的公钥，不保存私钥，因此这个调用获得了一次性的提权&lt;br&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;2.通过标准的用户密码，可以为应用程序提供一些基于session的权限验证&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;3.通过上述公私钥&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="50" y="670" width="220" height="110" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-17" value="申请Token时的安全权限验证：&lt;br&gt;请求方:node_id，该node的签名&lt;br&gt;安全隐患：node 私钥的泄露" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="470" y="80" width="195" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-19" value="应用泄露token的风险：&lt;br&gt;Token和EP绑定（和IP绑定？）&lt;br&gt;每个Service容器都一个独立IP会不会很夸张？" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="-140" y="550" width="195" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-20" value="frame service拥有内核（root）权限，安装不可靠的frame service有丢失所有数据的风险！" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="630" y="740" width="195" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="LHn_DE8s6H_Sm2WV2Dcl-21" target="LHn_DE8s6H_Sm2WV2Dcl-22" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="160" y="910"/>
                            <mxPoint x="160" y="910"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-21" value="app client" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="20" y="890" width="90" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-26" value="确认client身份" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="LHn_DE8s6H_Sm2WV2Dcl-22" target="LHn_DE8s6H_Sm2WV2Dcl-23" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-22" value="gateway&lt;br&gt;外部调用都过gateway" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="200" y="890" width="90" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-27" value="验证app权限" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="LHn_DE8s6H_Sm2WV2Dcl-23" target="LHn_DE8s6H_Sm2WV2Dcl-24" edge="1">
                    <mxGeometry x="0.0057" relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="540" y="910"/>
                            <mxPoint x="540" y="910"/>
                        </Array>
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-23" value="app service" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="400" y="890" width="90" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-24" value="frame-service" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="590" y="890" width="90" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-28" value="Data" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
                    <mxGeometry x="770" y="880" width="60" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-29" value="安全访问" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="LHn_DE8s6H_Sm2WV2Dcl-24" target="LHn_DE8s6H_Sm2WV2Dcl-28" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-31" value="一个请求有两个身份：&lt;br&gt;1. appid&lt;br&gt;2. 当前用户&lt;br&gt;&lt;br&gt;都验证为可信调用&lt;br&gt;否则为匿名调用（并不可信）&lt;br&gt;&lt;br&gt;只有填写正确的appid才有机会访问app的服务&lt;br&gt;&lt;br&gt;未填写appid是访问系统服务，很多时候对权限会有更高的要求。" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="-40" y="1030" width="170" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-32" value="分离token验证，在请求中带session_key，以及对session_key的验证，可以根据系统需要，扩展更多对验证方式的支持。" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="665" y="255" width="195" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="LHn_DE8s6H_Sm2WV2Dcl-33" value="web2.5的身份验证逻辑：&lt;br&gt;支持app client用传统协议来传递身份。通过gateway隔离后，app service的开发者也不用处理新的协议" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="400" y="1000" width="170" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-1" value="kernel service container" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
                    <mxGeometry x="200" y="1350" width="160" height="170" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-3" value="etcd" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="220" y="1450" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-4" value="dcfs" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="220" y="1400" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-5" value="eth0&lt;br&gt;192.168.1.222" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="320" y="1400" width="140" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-6" value="docker0" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="380" y="1360" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-8" value="第一个添加的OOD是主VLAN&lt;br&gt;kernel service container直接用host网络（提高性能）,其它服务看到的就是一个很标准的，来自OOD的网络协议包" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="195" y="1560" width="190" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-9" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="180" y="1640" width="320" height="210" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-10" value="kernel service container" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
                    <mxGeometry x="200" y="1660" width="190" height="170" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-11" value="etcd" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="215" y="1770" width="60" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-13" value="eth0&lt;br&gt;192.168.1.223" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="287.5" y="1710" width="82.5" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-14" value="docker0" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="410" y="1660" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-15" value="VPS上的第二OOD，容器使用NAT模式，通过host上的tunnel虚拟网卡，让容器加入了主OOD所在的局域网，能不能不动物理机的iptable?，局域网的其它服务，看到的是一个来自 第一OOD的另一块网卡的数据包" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="200" y="1870" width="310" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-16" value="dcfs" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="215" y="1710" width="60" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-17" value="eht0&lt;br&gt;23.239.23.54" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="410" y="1710" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-20" value="tunnel" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="hjjSVfZwhBp0PWB6v3EA-18" target="hjjSVfZwhBp0PWB6v3EA-19" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="540" y="1780"/>
                            <mxPoint x="540" y="1470"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-18" value="tun/tap&lt;br&gt;openvpn" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="410" y="1755" width="80" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-19" value="tun/tap&lt;br&gt;openvpn&lt;br&gt;192.168.1.223" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="380" y="1445" width="80" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-28" value="" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="170" y="1960" width="320" height="210" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-29" value="kernel service container" style="rounded=0;whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
                    <mxGeometry x="190" y="1980" width="190" height="170" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-30" value="etcd" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="205" y="2090" width="60" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-31" value="eth0&lt;br&gt;192.168.1.221" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="277.5" y="2030" width="82.5" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-32" value="docker0" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="400" y="1980" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-33" value="dcfs" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="205" y="2030" width="60" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-34" value="eht0&lt;br&gt;192.168.1.222" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="400" y="2030" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-35" value="tun/tap&lt;br&gt;openvpn" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="400" y="2075" width="80" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-36" value="另一个局域网的OOD，容器使用NAT模式，通过host上的tunnel虚拟网卡，让容器加入了主OOD所在的局域网。此时本局域网中的服务之间无法直接通信，需要绕行到" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="205" y="2200" width="190" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1.012;entryY=0.63;entryDx=0;entryDy=0;entryPerimeter=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="hjjSVfZwhBp0PWB6v3EA-35" target="hjjSVfZwhBp0PWB6v3EA-18" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="540" y="2100"/>
                            <mxPoint x="540" y="1786"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="hjjSVfZwhBp0PWB6v3EA-39" target="hjjSVfZwhBp0PWB6v3EA-40" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-39" value="用户进程&lt;br&gt;send(target_ip,data)" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="890" y="1370" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="hjjSVfZwhBp0PWB6v3EA-40" target="hjjSVfZwhBp0PWB6v3EA-41" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-40" value="内核network stack(iptable),进行路由" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1090" y="1370" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="hjjSVfZwhBp0PWB6v3EA-41" target="hjjSVfZwhBp0PWB6v3EA-44" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-41" value="根据路由结果找到网络设备,并将ip包写入设备的发送队列" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1275" y="1370" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="hjjSVfZwhBp0PWB6v3EA-44" target="hjjSVfZwhBp0PWB6v3EA-47" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-44" value="目标主机" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1570" y="1450" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-52" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="hjjSVfZwhBp0PWB6v3EA-46" target="hjjSVfZwhBp0PWB6v3EA-51" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-46" value="内核network stack(iptable),处理设备收到包，进行路由" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1090" y="1530" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-50" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="hjjSVfZwhBp0PWB6v3EA-47" target="hjjSVfZwhBp0PWB6v3EA-46" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-47" value="读取返回，写入设备的接收队列" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1270" y="1530" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="hjjSVfZwhBp0PWB6v3EA-51" value="用户进程&lt;br&gt;on_recv" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="890" y="1530" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="IwOimf6YcgUWfVzcZBG_-1" value="device用自己私钥构造service的启动token" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-750" y="100" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="IwOimf6YcgUWfVzcZBG_-2" value="service启动后，用该token与verify-hub通信，执行login操作" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-750" y="190" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="IwOimf6YcgUWfVzcZBG_-3" value="登录成功后得到一个由verify-hub签名的sesison-token" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-750" y="280" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="IwOimf6YcgUWfVzcZBG_-4" value="在上述Token过期前，与verify-hub通信获得下一个token(用上一个token换取即可）" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-750" y="380" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="BFy1MTNfwtilupp1LULl-4" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;verify-hub login流程&lt;/h1&gt;&lt;p&gt;1) 账户/密码登录&lt;/p&gt;&lt;p&gt;账户名是user_doc里的 user_name （创建后不可修改）,full_name作为显示的名字，是可以修改的；kv://users/$username/doc 的路径保证了username的唯一性&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;2) Token登录： 由trustkey 签名的JWT. JWT结构中的kid说明了该JWT是谁签名的. 登录逻辑会先确认该kid是否有效，然后再判断登录的userid / appid 是否有效&lt;/p&gt;&lt;p&gt;kid: root ，由系统的owner签名&lt;/p&gt;&lt;p&gt;kid:username, 由特定用户的私钥签名 （可以获得用户的sudo权限，比用户密码的权限略高）&lt;/p&gt;&lt;p&gt;kid:devicename, 系统里的OOD和Node的私钥签名。 kv://devices/$devicename/doc 保证了devicename的唯一性&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;3） 登录验证通过后，根据登录时的信息，verifvy-hub会签发一个JWT（有效期多少合适？）&lt;/span&gt;&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="-500" y="85" width="300" height="445" as="geometry"/>
                </mxCell>
                <mxCell id="BFy1MTNfwtilupp1LULl-5" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;服务校验session-token的通用流程&lt;/h1&gt;&lt;p&gt;1）根据kid在trust-key中得到公钥&lt;/p&gt;&lt;p&gt;有2个保存在zone-config中的kid是肯定会存在的&lt;/p&gt;&lt;p&gt;kid:root&lt;/p&gt;&lt;p&gt;kid:verify-hub&lt;/p&gt;&lt;p&gt;2）通过环境变量得到的kid （得不到zone_config时至少有一个可用的）&lt;/p&gt;&lt;p&gt;kid:当前设备的device_name(通过THIS_DEVICE）环境变量传入&lt;/p&gt;&lt;p&gt;3）有一些session token,要求kid于userid一致（不允许授权给其它人）&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="-510" y="540" width="300" height="290" as="geometry"/>
                </mxCell>
                <mxCell id="ZgWfReDg6R7gwXlHTyS7-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="oT2j73PS3qKXkgTkekL7-1" target="oT2j73PS3qKXkgTkekL7-2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-1" value="login_by_jwt" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-650" y="1010" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="oT2j73PS3qKXkgTkekL7-2" target="oT2j73PS3qKXkgTkekL7-3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="oT2j73PS3qKXkgTkekL7-2" target="oT2j73PS3qKXkgTkekL7-8" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-2" value="是verify-hub颁发的jwt?" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-675" y="1130" width="170" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="oT2j73PS3qKXkgTkekL7-3" target="oT2j73PS3qKXkgTkekL7-4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-3" value="判断nonce是否&amp;gt;=上一次登录的nonce" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-770" y="1240" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="oT2j73PS3qKXkgTkekL7-4" target="oT2j73PS3qKXkgTkekL7-5" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-4" value="构造并记录下一次刷新要带的nonce" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-770" y="1345" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="oT2j73PS3qKXkgTkekL7-5" target="oT2j73PS3qKXkgTkekL7-6" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-5" value="构造session token" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-770" y="1445" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="oT2j73PS3qKXkgTkekL7-6" target="oT2j73PS3qKXkgTkekL7-7" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-6" value="返回session token和nonce" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-770" y="1545" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-7" value="在session token过期前使用" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-640" y="1660" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="oT2j73PS3qKXkgTkekL7-8" target="oT2j73PS3qKXkgTkekL7-9" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-8" value="判断nonce是否与记录相同" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-520" y="1240" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="oT2j73PS3qKXkgTkekL7-9" target="oT2j73PS3qKXkgTkekL7-10" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-9" value="构造并记录下一次刷新要带的nonce" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-520" y="1350" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="oT2j73PS3qKXkgTkekL7-10" target="oT2j73PS3qKXkgTkekL7-11" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-10" value="构造session token" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-520" y="1445" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="oT2j73PS3qKXkgTkekL7-11" target="oT2j73PS3qKXkgTkekL7-7" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="oT2j73PS3qKXkgTkekL7-11" value="返回session token和nonce" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-520" y="1545" width="120" height="60" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram id="coYEm0tzWbkYcY7zp0FH" name="name-lib">
        <mxGraphModel dx="2331" dy="838" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-3" value="DID本身就包含了Public Key" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="1P2sjvWsDKO3EoMZSOwn-1" target="1P2sjvWsDKO3EoMZSOwn-2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="1P2sjvWsDKO3EoMZSOwn-1" target="1P2sjvWsDKO3EoMZSOwn-4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-1" value="DID" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="320" y="30" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-9" value="验证必须依赖" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="1P2sjvWsDKO3EoMZSOwn-2" target="1P2sjvWsDKO3EoMZSOwn-7" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-2" value="DID Public Key&lt;div&gt;(用于验证 DID的签名)&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="110" y="150" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="1P2sjvWsDKO3EoMZSOwn-4" target="1P2sjvWsDKO3EoMZSOwn-2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="1P2sjvWsDKO3EoMZSOwn-4" target="1P2sjvWsDKO3EoMZSOwn-7" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="1P2sjvWsDKO3EoMZSOwn-4" target="1P2sjvWsDKO3EoMZSOwn-22" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-4" value="Global Resovle" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="320" y="150" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="1P2sjvWsDKO3EoMZSOwn-7" target="1P2sjvWsDKO3EoMZSOwn-13" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-7" value="DID Document&lt;div&gt;因为有签名，所以是不可变信息&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="320" y="260" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="1P2sjvWsDKO3EoMZSOwn-13" target="1P2sjvWsDKO3EoMZSOwn-14" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-13" value="Owner Zone&lt;div&gt;(Zone DID)&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="320" y="350" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="1P2sjvWsDKO3EoMZSOwn-14" target="1P2sjvWsDKO3EoMZSOwn-17" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="1" source="1P2sjvWsDKO3EoMZSOwn-14" target="1P2sjvWsDKO3EoMZSOwn-18" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-14" value="&lt;p&gt;Zone Resovle&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;http://$zone_host/1.0/identifiers/$did&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;rtcp://$zone_gateway_did&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;/:80/identifiers/$did&lt;/span&gt;&lt;/p&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="257.5" y="455" width="245" height="65" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-17" value="DID Document&lt;div&gt;因为有签名，所以是不可变信息&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="220" y="555" width="120" height="155" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-18" value="&lt;div&gt;DID Info&lt;/div&gt;&lt;div&gt;可变信息&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="400" y="555" width="120" height="155" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-21" value="更新Global Resovle(DNS,BNS）中的信息，通常是缓慢且高成本的" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="440" y="110" width="210" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-22" value="ZoneGateway&lt;div&gt;Device DID&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="500" y="150" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-24" value="Build rtcp&lt;div&gt;使用rtcp通信可以让大量的应用不用处理身份验证&lt;/div&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;dashed=1;" parent="1" source="1P2sjvWsDKO3EoMZSOwn-22" edge="1">
                    <mxGeometry x="-0.2953" y="14" relative="1" as="geometry">
                        <mxPoint x="459" y="450" as="targetPoint"/>
                        <mxPoint x="10" y="-4" as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-25" value="尽量用Zone Resolve,少用Global Resolve" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="530" y="472.5" width="160" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-28" value="" style="endArrow=none;html=1;rounded=0;" parent="1" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="65" y="740" as="sourcePoint"/>
                        <mxPoint x="695" y="740" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-34" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="1P2sjvWsDKO3EoMZSOwn-29" target="1P2sjvWsDKO3EoMZSOwn-30" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-29" value="&lt;b&gt;与一个agent通信&lt;/b&gt;&lt;br&gt;did:agent:$agent_name:$zone_did" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="240" y="760" width="260" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-39" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="1P2sjvWsDKO3EoMZSOwn-30" target="1P2sjvWsDKO3EoMZSOwn-31" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-30" value="Global Resovle&lt;div&gt;$zone_did&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="240" y="860" width="260" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-40" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="1P2sjvWsDKO3EoMZSOwn-31" target="1P2sjvWsDKO3EoMZSOwn-32" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-31" value="Zone Resovle&lt;div&gt;http://$zone_host/1.0/identifiers/did:agent:$agent_name&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="205" y="960" width="330" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="1P2sjvWsDKO3EoMZSOwn-32" target="1P2sjvWsDKO3EoMZSOwn-33" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-32" value="Agent Document" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="310" y="1060" width="120" height="155" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-33" value="Post Agent Message to Agent Endpoint" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="310" y="1250" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="1P2sjvWsDKO3EoMZSOwn-41" value="" style="endArrow=none;html=1;rounded=0;" parent="1" edge="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="65" y="1350" as="sourcePoint"/>
                        <mxPoint x="695" y="1350" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram id="0Y17DWSzZZsquk_YFecL" name="Agent App">
        <mxGraphModel dx="810" dy="1961" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="Ih0z0G4T_rDQ9Utei5Il-8" value="Agent的运行容器可以持续扩展，不同的Agent可以运行在不同的容器中。系统通过Agent Msg和Workspace定义了Agent与外部世界交互的标准方法。workspace是可以扩展的。&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Agent与外界的交互具有可观察性，是外向的。Agent的Memory是完全内向的&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="930" y="-990" width="150" height="190" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-2" value="AI Compute Kernel" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1120" y="-775" width="130" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-3" value="MsgQueue" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1035" y="-678" width="130" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-4" value="TaskMgr" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1220" y="-678" width="130" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-6" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;dashed=1;dashPattern=8 8;" vertex="1" parent="1">
                    <mxGeometry x="1102.5" y="-980" width="165" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-7" value="Agent1" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1115" y="-950" width="135" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-8" value="Memory&lt;div&gt;文件夹&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1115" y="-888" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-28" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="e6VtaDdwPvUsGqGn1qCW-9" target="e6VtaDdwPvUsGqGn1qCW-27">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-30" value="同构直发，agent高效协作" style="edgeStyle=none;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="e6VtaDdwPvUsGqGn1qCW-9" target="e6VtaDdwPvUsGqGn1qCW-29">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-9" value="Workspace&lt;div&gt;tools/skills/code interpter&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1190" y="-888" width="160" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-10" value="行为-&amp;gt;LLM&amp;nbsp; Process" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1120" y="-840" width="140" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-11" value="Agent 运行容器" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
                    <mxGeometry x="1112.5" y="-980" width="97.5" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-12" value="知识库&lt;div&gt;图数据库?&lt;/div&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" vertex="1" parent="1">
                    <mxGeometry x="1280" y="-777.5" width="80" height="65" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-13" value="深度记忆系统" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" vertex="1" parent="1">
                    <mxGeometry x="1020" y="-777.5" width="60" height="65" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-23" style="edgeStyle=none;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="e6VtaDdwPvUsGqGn1qCW-15" target="e6VtaDdwPvUsGqGn1qCW-22">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-15" value="Agent&lt;br&gt;Msg" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;" vertex="1" parent="1">
                    <mxGeometry x="1430" y="-966" width="72" height="72" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-16" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;rounded=0;" edge="1" parent="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="900" y="-790" as="sourcePoint"/>
                        <mxPoint x="1740" y="-788" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-17" value="内核" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
                    <mxGeometry x="920" y="-790" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-18" value="AgentMsg 协议&lt;div&gt;1. Agent都有DID&lt;/div&gt;&lt;div&gt;2.可以基于DID构造发送消息的http接口，实现给Agent发消息的。这是一个稳定的，外界与Agent沟通的方法&lt;/div&gt;&lt;div&gt;3. Agent回复消息：&lt;/div&gt;&lt;div&gt;a) Agent需要识别消息来源实体，并通过contact mgr的信息进行合并&lt;/div&gt;&lt;div&gt;b) Agent的心智模型是：选择tunnel向指定实体发送消息&lt;/div&gt;&lt;div&gt;c) 回复消息与接收消息不是一一对应的，而是Agent觉得需要就回复&lt;/div&gt;&lt;div&gt;d) 观察Agent的工作情况，是通过TaskMgr + Workspace的观察接口，不是Agent通过回复消息实现的&lt;/div&gt;&lt;div&gt;e) Agent根据消息的来源，构造正确的回复方法。本质上两种&lt;br&gt;- 可以立刻回复的（调用成功就是回复成功）&lt;/div&gt;&lt;div&gt;- 需要进行发送解耦的，放入系统的Outbox，由另一个系统服务负责进行可靠发送&lt;/div&gt;&lt;div&gt;4. 注意AgentMsg原生对群聊的支持&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
                    <mxGeometry x="1780" y="-810" width="300" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-21" style="edgeStyle=none;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="e6VtaDdwPvUsGqGn1qCW-19" target="e6VtaDdwPvUsGqGn1qCW-15">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-19" value="did:bns:$a_name.$zone&lt;div&gt;http方法&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1550" y="-960" width="140" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-24" style="edgeStyle=none;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="e6VtaDdwPvUsGqGn1qCW-22" target="e6VtaDdwPvUsGqGn1qCW-7">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-22" value="inbox" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1320" y="-945" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-26" style="edgeStyle=none;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="e6VtaDdwPvUsGqGn1qCW-25" target="e6VtaDdwPvUsGqGn1qCW-19">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-25" value="Telegram Tunnel&lt;div&gt;Telegram bot&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1780" y="-1040" width="140" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-38" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" edge="1" parent="1" source="e6VtaDdwPvUsGqGn1qCW-27" target="e6VtaDdwPvUsGqGn1qCW-36">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-27" value="outbox" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1502" y="-888" width="80" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-29" value="zone内另一个agent inbox" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1446" y="-828" width="104" height="32" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-31" value="Slack Tunnel" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1780" y="-950" width="140" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-32" style="edgeStyle=none;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.978;entryY=0.662;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="e6VtaDdwPvUsGqGn1qCW-31" target="e6VtaDdwPvUsGqGn1qCW-19">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-33" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;" edge="1" parent="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="1740" y="-790" as="sourcePoint"/>
                        <mxPoint x="1740" y="-1010" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-35" value="Zone边界" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" vertex="1" connectable="0" parent="e6VtaDdwPvUsGqGn1qCW-33">
                    <mxGeometry x="-0.4845" y="1" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-39" style="edgeStyle=none;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" edge="1" parent="1" source="e6VtaDdwPvUsGqGn1qCW-36" target="e6VtaDdwPvUsGqGn1qCW-31">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-36" value="系统发送服务&lt;div&gt;处理用&#39;任意tunnel&#39;发送&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1610" y="-888" width="80" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-40" value="ContactMgr" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1390" y="-678" width="130" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-43" value="Agent的协作&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Agent必然会通过协作完成复杂工作。协作分了下面几种类型&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1) sub agent协作：Agent为了完成工作，临时创建了agent,共享自己的worksapce + memory(可选）来共同完成工作。这些sub agent共享主agent的资源&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2）纯AI Agent协作：和Zone内其它的AI Agent协作。大家通过公共的Workspace和AgentMsg进行沟通。但绝不共享各自的Memory.在协作的过程中，某个AI Agent使用sub agent完成其工作的过程，对其它Agent是透明的。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3）外部协作：通过Agent Msg和外部实体协作。这种协作是比较简单的。更复杂的情况是共享Workspace给外部实体，共同修改。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Agent与人的协作，也属于这个类型&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
                    <mxGeometry x="1540" y="-530" width="255" height="330" as="geometry"/>
                </mxCell>
                <mxCell id="e6VtaDdwPvUsGqGn1qCW-44" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;workspace是什么&lt;/h1&gt;&lt;p&gt;workspace是Agent交付成功的地方。如果没有workspace，那么Agent对外沟通(交付成功）的方法只有Agent Msg&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Agent 内部为了实现目的，总是有一个workspace的（基础工具组合，最强力的工具就是coding 工具), Agent 可以根据自己的角色，环境，使用这些工具--&amp;gt;workspace是为支持完成某类工作设计的。比工作流更基础，是工作流的基础。类似车库，摆满了各种工具。这里最重要的工具是制造工具的工具（3D打印机)&lt;/p&gt;&lt;p&gt;构造合适的Workspace是一种元能力。使用确定的Workspace是一种能力。为了提高正确率，人类可以要求必须使用某个特定的Workspace来进行协作&lt;/p&gt;&lt;p&gt;结论：&lt;/p&gt;&lt;p&gt;Workspace用来做结果交付&lt;/p&gt;&lt;p&gt;外部，用来做结果交付的worksapce是一个did-doucment标识的http 服务。&lt;/p&gt;&lt;p&gt;内部的workspace（改名字？workshop?）是一个“skills集合”，其实就是一台电脑 --&amp;gt; 怎样使用电脑的能力强&lt;/p&gt;&lt;p&gt;- 用命令行&lt;/p&gt;&lt;p&gt;- 用图形App（比如浏览器）&lt;/p&gt;&lt;p&gt;这个是Agent特别不擅长的&lt;/p&gt;&lt;p&gt;- 用代码（理论上可以干一切）&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
                    <mxGeometry x="905" y="-550" width="570" height="500" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram id="yT246MxJrNwgLdexHOI-" name="pkg system">
        <mxGraphModel dx="3091" dy="2262" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="soKJ22ut9W6iChpHjKMU-1" value="安装app&lt;br&gt;bpm install buckyos-filebrowser" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="65" y="80" width="230" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-2" value="升级frame&lt;br&gt;bpm upgrade dfs" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-200" y="80" width="230" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-3" value="升级系统&lt;br&gt;bpm upgrade" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="-470" y="80" width="230" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-4" value="自动执行，bpm update&lt;br&gt;同步pakcage index&lt;br&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="90" y="220" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-5" value="repo server&lt;br&gt;（other repo）" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="620" y="200" width="160" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.999;entryY=0.433;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="soKJ22ut9W6iChpHjKMU-5" target="soKJ22ut9W6iChpHjKMU-4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-7" value="得到buckyos-filebrowser的defualt 版本id" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="90" y="330" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-8" value="发起下载任务,并等待任务结束" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="90" y="430" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-13" value="更新zone repo中的 index,让buckyos-filebrowser的版本号指向新版本" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="90" y="530" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-14" value="zone-repo-server的操作完成" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="90" y="630" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="soKJ22ut9W6iChpHjKMU-15" target="soKJ22ut9W6iChpHjKMU-8" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-17" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="50" y="170" width="260" height="550" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-15" value="oods&lt;br&gt;(other repo)" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="610" y="415" width="160" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-18" value="从仓库安装包" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="130" y="180" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-19" value="Bucky Store.install app" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;verticalAlign=top;" parent="1" vertex="1">
                    <mxGeometry x="50" y="770" width="260" height="320" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-21" value="询问zone-repo 对应的pkg是否已经就绪" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="80" y="820" width="200" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-22" value="等待用户Confirm Install (有参数配置)" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="80" y="890" width="200" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-23" value="写入SystemConfig" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="80" y="960" width="200" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-24" value="由repo server组成的network" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="380" y="330" width="195" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-25" value="唤醒调度器，调度器构造node-config" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="80" y="1020" width="200" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-26" value="node_daemon&lt;br&gt;&lt;br&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=none;verticalAlign=top;" parent="1" vertex="1">
                    <mxGeometry x="50" y="1150" width="260" height="350" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-27" value="启动app service(有更精细的pkgid)" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="80" y="1190" width="200" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-28" value="尝试load 指定版本的pkg" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="80" y="1270" width="200" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-29" value="如load 失败，则去本地的repo-server上下载pkg" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="80" y="1350" width="200" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.998;entryY=0.37;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="soKJ22ut9W6iChpHjKMU-17" target="soKJ22ut9W6iChpHjKMU-29" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-31" value="再次尝试启动" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="80" y="1430" width="200" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="soKJ22ut9W6iChpHjKMU-32" value="一个应用的安装，会给系统里添加多个pkg" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="365" y="1240" width="155" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-1" value="可信的pkg db下载" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="950" y="210" width="180" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="lWEpS2572HMjW-OEhioc-3" target="lWEpS2572HMjW-OEhioc-4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-3" value="源URL&lt;div&gt;FileObject&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="950" y="250" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-4" value="pkg-DB&lt;div&gt;app-db?&lt;/div&gt;" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
                    <mxGeometry x="1170" y="240" width="60" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-5" value="1.通过一个非did:key:xxxx 的DID，如何可信的得到公钥?&amp;nbsp;&lt;div&gt;方案1：公钥保存在DNS TXT记录中，这个方案本质上还是依赖对&quot;DNS的拥有&quot;，流程上绕过了https的证书体系，只需要拥有DNS即可&lt;/div&gt;&lt;div&gt;方案2:&amp;nbsp; &amp;nbsp;公钥保存在某个智能合约中（BNS），如果BNS上有记录，则可信度超过DNS。对于用户（名字的拥有者）来说，必须同时拥有两者，99%的情况下这两个系统都会查询回相同的结果。当不同的时候，系统优先信任BNS。 但是建立可信的BNS查询需要同步区块，需要消耗较多的本地资源。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;为了开发方便：本地的known_did的优先级总是最高的。&lt;/div&gt;&lt;div&gt;成功验证过的did_doc会放到local cache中。以降低查找频次。&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1290" y="170" width="280" height="250" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-6" value="1. 根据URL所在Zone的Trust Key list对FileObject进行验证.FileObject中包含了pkg-db的sha256 hash&lt;div&gt;2. 验证pkg-db的 hash&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="965" y="330" width="250" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-7" value="app-pkg-db中的可信app_doc" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="950" y="420" width="180" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-8" value="查询得到" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="lWEpS2572HMjW-OEhioc-9" target="lWEpS2572HMjW-OEhioc-11" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-9" value="app_id" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="950" y="460" width="120" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="lWEpS2572HMjW-OEhioc-11" target="lWEpS2572HMjW-OEhioc-13" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-11" value="app_doc,&lt;div&gt;由app_owner签名&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1150" y="460" width="120" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="lWEpS2572HMjW-OEhioc-13" target="lWEpS2572HMjW-OEhioc-14" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-13" value="通过app_owner的did得到必要的turst key" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1330" y="460" width="120" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-14" value="用trust key验证app_doc的签名" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1510" y="460" width="120" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-15" value="app_doc中包含pkg_id,pkg_id中有sha:256信息" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1" parent="1" vertex="1">
                    <mxGeometry x="950" y="530" width="280" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-16" value="sha:256" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="950" y="590" width="120" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-17" value="pkg" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
                    <mxGeometry x="1170" y="570" width="60" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="lWEpS2572HMjW-OEhioc-16" target="lWEpS2572HMjW-OEhioc-17" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-19" value="通过sha256下载chunk是不需要进行签名校验，且不需要https支持的。可以拼接2个URL进行下载&lt;div&gt;1. app_owner zone的链接&lt;/div&gt;&lt;div&gt;2. 源 zone的链接&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1290" y="570" width="280" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-20" value="上述流程的反向就是app的发布&lt;div&gt;1. 先本地build,打包，得到包的sha256&lt;/div&gt;&lt;div&gt;2.构造app新版本的 app_doc&lt;/div&gt;&lt;div&gt;3.用owner签名&lt;/div&gt;&lt;div&gt;4. 将pkg发布到自己zone的repo&amp;nbsp; or ndn mgr?&lt;/div&gt;&lt;div&gt;5.将签名的app_doc发的到处都是,包括自己的repo&lt;/div&gt;&lt;div&gt;6.源订阅的定期跟踪机制通过跟踪收录app_id的原始URL，可以看到app_doc的更新，验证后收入到pkg_db,并定时产生新的pkg-db&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="910" y="660" width="420" height="130" as="geometry"/>
                </mxCell>
                <mxCell id="lWEpS2572HMjW-OEhioc-21" value="验证app_doc的流程与app_doc的获取无关&lt;div&gt;app_doc甚至可以是自验证的（发布者用did:key:xxxx)&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1237.5" y="500" width="305" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="R2PdDVwk_Y7z2gshV6vo-1" value="通过NDN URL 发布内容，相当于将内容保存到系统里（URL不再与appid相关）&lt;div&gt;repo实现了订阅源&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;管理appid-&amp;gt;app_doc&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;管理pkg-db&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontColor=#CC0000;" parent="1" vertex="1">
                    <mxGeometry x="1370" y="670" width="430" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="R2PdDVwk_Y7z2gshV6vo-3" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;NDN的url设计&lt;/h1&gt;&lt;p&gt;https://$base32objid.zoneid/inner_path.&amp;nbsp; 用objid公共发布内容. 一般是objid本身指向folder这种有容器的obj才会使用这种方式。 目前这种格式只有手工发布才会使用（系统目前不使用这种方法）&lt;/p&gt;&lt;p&gt;https://zoneid/ndn/$pub_path/$objid/obj_inner_path&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;https://zoneid/ndn/$pub_rpath&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;上述两种最常用，可以基于pub_path做一些更全局的权限控制&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;https://sys.$zoneid/ndn/&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;$pub_path/&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;$objid/inner_path&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;https://sys.zoneid/ndn/$pub_rpath&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;上面两种用于zone内访问。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;所有的zone内服务都可以通过访问default named mgr数据发布到zone 内&lt;/p&gt;&lt;p&gt;通过调用 sys.zoneid/publish.html ，用户确认后，可以将数据正式发布到公共的named mgr, 该named mgr的写入需要&lt;font style=&quot;color: rgb(204, 0, 0);&quot;&gt;普通用户的管理级别权限,ID是 userid&lt;/font&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;构造NDN URL意味着发布。发布后只保证数据获取的可校验性，数据的可确权性，不保护数据传输的私密性（允许监听），允许任何人保存。（发布后的数据原理上不可被彻底删除）&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1930" y="140" width="460" height="510" as="geometry"/>
                </mxCell>
                <mxCell id="R2PdDVwk_Y7z2gshV6vo-4" value="关于pkg-id&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;使用者总是倾向于用 “友好方式”使用pkg-id,完整的pkg-id包括&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;channel:namespace:pkgid:pkg-version:pkg-chunkid 这么多段落,&lt;/div&gt;&lt;div&gt;env.load(pkg_id)会根据当前env的默认配置来加载pkg-id&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;pkg-id因为会出现在域名中，所以和userid一样，只能使用域名有效字符。并不允许使用 _ （&lt;font style=&quot;color: rgb(153, 0, 77);&quot;&gt;系统里的各种id的统一可用字符标准&lt;/font&gt;）&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1000" y="-20" width="380" height="150" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    <diagram id="JvShwL8G7op1oZlSJPBe" name="Zone的OP级流程">
        <mxGraphModel dx="2331" dy="838" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-1" value="用户扩展的App的运行逻辑" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1290" y="1070" width="170" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-3" target="Uhl6TVcSV4RiziGJbxAS-5" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-3" value="内核启动应用" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1330" y="1160" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;dashPattern=8 8;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-5" target="Uhl6TVcSV4RiziGJbxAS-64" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-5" value="从系统应用安装配置中读取应用的拓扑配置，并修改ETCD" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1330" y="1260" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-7" target="Uhl6TVcSV4RiziGJbxAS-9" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-7" value="app process start" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1570" y="1460" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-9" target="Uhl6TVcSV4RiziGJbxAS-11" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-9" value="从系统的/etc/dapp_id/目录下读取核心配置" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1570" y="1580" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-11" target="Uhl6TVcSV4RiziGJbxAS-13" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-11" value="初始化，通过DFS读取数据并校验" style="whiteSpace=wrap;html=1;rounded=1;" parent="1" vertex="1">
                    <mxGeometry x="1570" y="1685" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-13" target="Uhl6TVcSV4RiziGJbxAS-15" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-13" value="读取/更新 Local Cache（可选）" style="whiteSpace=wrap;html=1;rounded=1;" parent="1" vertex="1">
                    <mxGeometry x="1570" y="1810" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-14" value="调用系统服务" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-15" target="Uhl6TVcSV4RiziGJbxAS-65" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-15" value="提供APP服务" style="whiteSpace=wrap;html=1;rounded=1;" parent="1" vertex="1">
                    <mxGeometry x="1570" y="1930" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-17" target="Uhl6TVcSV4RiziGJbxAS-19" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-17" value="更新新的ETCD配置" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="960" y="175" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-19" target="Uhl6TVcSV4RiziGJbxAS-22" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-19" value="node启动，读取内核配置，准备ETCD数据" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="960" y="275" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-21" target="Uhl6TVcSV4RiziGJbxAS-19" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-21" value="从已知的备份路径下载并校验" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="770" y="275" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-22" value="数据校验通过，启动ETCD" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="960" y="365" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-23" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-24" target="Uhl6TVcSV4RiziGJbxAS-26" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-24" value="BIOS阶段：机器等待激化（Zone信息）" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1210" y="130" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-25" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-26" target="Uhl6TVcSV4RiziGJbxAS-28" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-26" value="buckyos引导阶段: Zone完成引导，成为可用的Zone" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1210" y="270" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-27" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-28" target="Uhl6TVcSV4RiziGJbxAS-29" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-28" value="各个System Service开始初始化" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1210" y="410" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-29" value="系统启动成功，可以运行用户态的软件" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1217.5" y="550" width="135" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-30" value="当系统发生较大变化后，集群有可能会重启。这个阶段出现问题，一般需要物理机操作进行修复" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1380" y="285" width="180" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-31" value="系统发生较大变化后，SystemService也需要较长时间初始化。这个阶段出现问题，可以用 OS CLI进行修复（）" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1385" y="405" width="170" height="65" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-32" value="" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.annotation_2;align=left;labelPosition=right;pointerEvents=1;rotation=-180;" parent="1" vertex="1">
                    <mxGeometry x="1140" y="250" width="50" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-34" target="Uhl6TVcSV4RiziGJbxAS-70" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-34" value="内核调度器确认故障&lt;br&gt;（故障的发现是可扩展的）" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1925" y="220" width="157.5" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-70" target="Uhl6TVcSV4RiziGJbxAS-67" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1997.5" y="542.5" as="sourcePoint"/>
                        <mxPoint x="1997.5" y="637.5" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-36" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-37" target="Uhl6TVcSV4RiziGJbxAS-43" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-37" value="产生系统警告，系统进入黄色状态" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="2142.5" y="425" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-38" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-39" target="Uhl6TVcSV4RiziGJbxAS-42" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-39" value="系统停机，进入维修诊断（只读）状态" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1742.5" y="435" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-41" target="Uhl6TVcSV4RiziGJbxAS-47" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-41" value="系统配置更新（Scale）" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="2870" y="210" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-42" value="完成修复后，手工重新启动系统" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1742.5" y="550" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-43" value="等待修复完成后（更新配置），手工标记故障排除" style="whiteSpace=wrap;html=1;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="2142.5" y="545" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-45" target="Uhl6TVcSV4RiziGJbxAS-41" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-45" value="配置改变工具会尽力构造一次安全的配置更新" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="2620" y="210" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-47" target="Uhl6TVcSV4RiziGJbxAS-49" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-47" value="创建 维护Task（可选）" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="2870" y="320" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-48" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-49" target="Uhl6TVcSV4RiziGJbxAS-51" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-49" value="等待阻塞维护任务完成" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="2870" y="420" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-50" value="所有维护任务完成" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-51" target="Uhl6TVcSV4RiziGJbxAS-52" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-51" value="系统正常运行&lt;br&gt;（维护任务在后台运行）" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="2870" y="520" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-52" value="系统正常运行" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="2870" y="640" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-53" style="edgeStyle=none;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-54" target="Uhl6TVcSV4RiziGJbxAS-34" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-54" value="etcd故障" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1730" y="72.5" width="140" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-55" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-56" target="Uhl6TVcSV4RiziGJbxAS-34" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-56" value="租约协议故障？&lt;br&gt;严格控制租约的使用" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1930" y="72.5" width="140" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-57" style="edgeStyle=none;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.797;entryY=0.017;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-58" target="Uhl6TVcSV4RiziGJbxAS-34" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-58" value="内核日志与应用日志" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="2125" y="72.5" width="140" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-59" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-60" target="Uhl6TVcSV4RiziGJbxAS-7" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-60" value="根据拓扑配置在一些node上启动容器(Docer/VM)" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1570" y="1365" width="120" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-61" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-62" target="Uhl6TVcSV4RiziGJbxAS-64" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-62" value="node_daemon循环" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1570" y="1160" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-63" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-64" target="Uhl6TVcSV4RiziGJbxAS-60" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-64" value="读取etcd,发现node配置改变" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1570" y="1260" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-65" value="内核服务" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1330" y="1930" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-66" value="我们鼓励App开发者使用基于Object Storage的DFS来提高服务的，性能，可靠性和可用性&amp;nbsp;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1350" y="1700" width="180" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-67" value="内核调度器尝试修改运行配置（可选）" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1925" y="425" width="157.5" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-68" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-70" target="Uhl6TVcSV4RiziGJbxAS-39" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-69" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-70" target="Uhl6TVcSV4RiziGJbxAS-37" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-70" value="故障决策" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1925" y="330" width="157.5" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-71" value="Zone的启动流程" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="950" y="70" width="170" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-72" value="Zone的故障处理" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="1742.5" y="20" width="170" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-73" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-74" target="Uhl6TVcSV4RiziGJbxAS-45" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-74" value="Zone拓扑改变" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="2620" y="110" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-75" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-76" target="Uhl6TVcSV4RiziGJbxAS-80" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-76" value="备份开始" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3360" y="160" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-77" value="备份&lt;br&gt;对于有3个物理节点的Zone来说，数据是基本可靠的保持在DFS上的。备份行为指的是定期的Zone外冷备份（存在丢一小部分数据的可能性）。" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="3360" y="43" width="220" height="67" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-78" value="从备份中恢复&lt;br&gt;1.手工触发&lt;br&gt;2. Zone重建" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
                    <mxGeometry x="3850" y="40" width="130" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-79" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-80" target="Uhl6TVcSV4RiziGJbxAS-84" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-80" value="系统进入只读状态（可选）" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3360" y="270" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-81" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-82" target="Uhl6TVcSV4RiziGJbxAS-86" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-82" value="打包系统保存在dcfs上的数据（各个system service同步备份）" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3360" y="480" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-83" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-84" target="Uhl6TVcSV4RiziGJbxAS-82" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-84" value="打包etcd的所有数据" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3360" y="380" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-85" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-86" target="Uhl6TVcSV4RiziGJbxAS-88" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-86" value="备份上述数据到backup server" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3360" y="590" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-87" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-88" target="Uhl6TVcSV4RiziGJbxAS-90" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-88" value="逐个应用备份数据&lt;br&gt;（并行备份）" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3360" y="710" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-89" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-90" target="Uhl6TVcSV4RiziGJbxAS-91" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-90" value="备份完成" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3360" y="820" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-91" value="在NameService(Meta-Chain)上保存备份结果（可选）" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3360" y="930" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-92" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-93" target="Uhl6TVcSV4RiziGJbxAS-95" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-93" value="开始恢复" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3840" y="160" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-94" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-95" target="Uhl6TVcSV4RiziGJbxAS-105" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-95" value="系统进入未引导状态" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3840" y="260" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-96" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-97" target="Uhl6TVcSV4RiziGJbxAS-99" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-97" value="恢复etcd数据" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3840" y="560" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-98" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-99" target="Uhl6TVcSV4RiziGJbxAS-101" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-99" value="启动etcd" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3840" y="660" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-100" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-101" target="Uhl6TVcSV4RiziGJbxAS-107" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-101" value="恢复保存在DFS上的系统数据数据" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3840" y="760" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-102" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-103" target="Uhl6TVcSV4RiziGJbxAS-97" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-103" value="从备份服务器上获取备份" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3840" y="460" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-104" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-105" target="Uhl6TVcSV4RiziGJbxAS-103" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-105" value="得到待恢复备份数据的元信息" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3840" y="360" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-106" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-107" target="Uhl6TVcSV4RiziGJbxAS-108" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-107" value="恢复保存在DFS上的应用数据" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3840" y="860" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-108" value="恢复完成，进入Zone的引导逻辑" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="3840" y="950" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-109" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-110" target="Uhl6TVcSV4RiziGJbxAS-112" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-110" value="安装应用" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1100" y="1160" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-111" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="Uhl6TVcSV4RiziGJbxAS-112" target="Uhl6TVcSV4RiziGJbxAS-5" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-112" value="根据Zone的拓扑，自动构建启动拓扑配置并保存" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="1100" y="1260" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="Uhl6TVcSV4RiziGJbxAS-113" value="和k8s不同，我们并不在小的Zone里启用“编排”，而是更多以固定配置来运行应用服务" style="strokeWidth=1;shadow=0;dashed=0;align=center;html=1;shape=mxgraph.mockup.text.stickyNote2;fontColor=#666666;mainText=;fontSize=17;whiteSpace=wrap;fillColor=#ffffcc;strokeColor=#F62E00;" parent="1" vertex="1">
                    <mxGeometry x="1180" y="1370" width="200" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="tug6-lGKLGd_aUpJzQRX-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="tug6-lGKLGd_aUpJzQRX-1" target="tug6-lGKLGd_aUpJzQRX-2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tug6-lGKLGd_aUpJzQRX-1" value="read zone_name from node_identifiy" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="130" y="130" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="tug6-lGKLGd_aUpJzQRX-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="tug6-lGKLGd_aUpJzQRX-2" target="tug6-lGKLGd_aUpJzQRX-4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tug6-lGKLGd_aUpJzQRX-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="tug6-lGKLGd_aUpJzQRX-2" target="tug6-lGKLGd_aUpJzQRX-7" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tug6-lGKLGd_aUpJzQRX-2" value="zone_name is did?" style="rhombus;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="110" y="255" width="160" height="95" as="geometry"/>
                </mxCell>
                <mxCell id="tug6-lGKLGd_aUpJzQRX-3" value="zone_cofing = name_client.resolve_did(zone_id)" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="90" y="510" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="tug6-lGKLGd_aUpJzQRX-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="tug6-lGKLGd_aUpJzQRX-4" target="tug6-lGKLGd_aUpJzQRX-16" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tug6-lGKLGd_aUpJzQRX-4" value="name_info = name_client.resolve_name(zone_name)" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="330" y="277.5" width="260" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="tug6-lGKLGd_aUpJzQRX-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="tug6-lGKLGd_aUpJzQRX-6" target="tug6-lGKLGd_aUpJzQRX-3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tug6-lGKLGd_aUpJzQRX-6" value="parser name_info, &lt;br&gt;get zone_id&lt;br&gt;might get zone_did_document&amp;nbsp;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="375" y="510" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="tug6-lGKLGd_aUpJzQRX-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="tug6-lGKLGd_aUpJzQRX-7" target="tug6-lGKLGd_aUpJzQRX-3" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tug6-lGKLGd_aUpJzQRX-7" value="zone_id = zone_name" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="130" y="407.5" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="tug6-lGKLGd_aUpJzQRX-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="tug6-lGKLGd_aUpJzQRX-16" target="tug6-lGKLGd_aUpJzQRX-6" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tug6-lGKLGd_aUpJzQRX-16" value="provider do query and verify result" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
                    <mxGeometry x="375" y="380" width="170" height="60" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>
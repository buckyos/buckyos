## 目的

账号模块主要支持让用户可以用传统的用户名和密码的方式使用Buckyos，优化Buckyos的用户体验。

由于Buckyos的用户底层实现采用了[W3C DID](https://www.w3.org/TR/2022/REC-did-core-20220719/)规范，该规范实现依赖于公私钥加密、区块链等技术，如果直接让用户使用DID，则需要用户理解相关联的技术才行，这样对用户要求非常高，将会极大的不利于Buckyos的推广，因此需要一个让用户熟悉的方式才行，而用户名密码是所有互联网用户都接受和使用过的方式。

## 账户类型

Buckyos账户有两种类型：中心化账号、本地账号

##### 中心化账号

- Buckyos提供的账号服务，它是中心化的，用户信息存储在Buckyos提供的服务器上，DID可以直接使用用户名，这样对用户来说更自然，体验比较好。

- 支持修改登录密码，登录账号不可修改

- 支持从云端修改密钥


- 账户支持从服务器迁移到个人设备上，不过迁移过程中需要将相关信息上链，需要用户付出一定的成本。


- 必须由用户主动注册。

- 用户权限从属于Zone，不同的Zone用户权限不同，Zone管理员可以邀请其它用户成为该Zone用户并指定在该Zone内的权限。

- 新注册的账户不属于任何Zone。如果新建Zone则自动成为该Zone管理员，也可以通过别人邀请成为其它Zone用户。

- 只有zone管理员才能绑定设备，绑定设备之后在设备本地会生成Zone内所有管理员账号相同用户名和密码但did信息不同的本地账号，如果本地Zone联网时则直接使用中心化账号的DID，如果未联网则只使用本地的did信息。登录之后根据权限可以执行本地账号所有操作。

- did形式：did:bid:$username

##### 本地账号

- 用户在自己本地Zone上创建账号，用户信息存储在Zone包含的设备上。本地账号只能是自包含DID，就是通过DID Document可以自己验证DID的有效性，而不需DID Document从可信源下载，如DID就是公钥的hash。

- 远程账号绑定设备时本地会生成跟远程账号用户名和密码相同的本地账号。

- 支持修改登录密码，登录账号不可修改

- 不支持修改密钥

- 用户权限从属于Zone，不同的Zone用户权限不同，Zone管理员可以直接创建本地账户，同时也可以删除账户，还可以邀请其它用户成为该Zone用户。管理页可以修改用户在该Zone内的权限。

- 本地Zone中上第一个创建的账户自动成为该Zone管理员。

- 本地账号中的管理员，还可以调整Zone中用户权限。

- did形式：did:lbid:$publickey_hash

不管是中心化账号和本地账号登录完成之后生成DID相关信息，该用户的后续操作都遵从DID权限校验逻辑。

## 账户基本信息

用户名、密码、DID、DID Document。

## 实现描述

根据上面描述中心化账号和本地账号的核心逻辑都是相同的，只是存储方式不同，因此可以分成部分实现：

1. 私钥管理模块：负责私钥的管理，包括私钥创建、存储、签名操作。
2. 账号存储模块：主要实现账号除的存储，中心化账号和本地账号不同。
3. 账号基础模块：包含账号的创建、管理、登录验证等接口，上层服务都通过该模块接口使用账号服务，通过参数化账号管理模块和私钥管理模块，实现中心化账号和本地账号的不同需求。
4. 业务需求模块：调用账号基础模块的接口实现业务需求，如支持跨进程、跨网络调用的接口，本地账号管理员创建、删除账号等。
